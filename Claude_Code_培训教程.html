<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>🎓 Claude Code 培训教程 | My Awesome Project</title>
    <meta name="description" content="A VitePress Site">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/guogao-doc/assets/style.CGdbE5Xl.css" as="style">
    <link rel="preload stylesheet" href="/guogao-doc/vp-icons.css" as="style">
    
    <script type="module" src="/guogao-doc/assets/app.Cb36q6at.js"></script>
    <link rel="preload" href="/guogao-doc/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/guogao-doc/assets/chunks/theme.ep95m6mm.js">
    <link rel="modulepreload" href="/guogao-doc/assets/chunks/framework.UJbk18kQ.js">
    <link rel="modulepreload" href="/guogao-doc/assets/Claude_Code_培训教程.md.5x5xO3Vn.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-4813dc16><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c7c7d332></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c7c7d332>Skip to content</a><!--]--><!----><header class="VPNav" data-v-4813dc16 data-v-22c67d4f><div class="VPNavBar" data-v-22c67d4f data-v-438b78f0><div class="wrapper" data-v-438b78f0><div class="container" data-v-438b78f0><div class="title" data-v-438b78f0><div class="VPNavBarTitle has-sidebar" data-v-438b78f0 data-v-86e180a2><a class="title" href="/guogao-doc/" data-v-86e180a2><!--[--><!--]--><!----><span data-v-86e180a2>My Awesome Project</span><!--[--><!--]--></a></div></div><div class="content" data-v-438b78f0><div class="content-body" data-v-438b78f0><!--[--><!--]--><div class="VPNavBarSearch search" data-v-438b78f0><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-438b78f0 data-v-88d68326><span id="main-nav-aria-label" class="visually-hidden" data-v-88d68326> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guogao-doc/" tabindex="0" data-v-88d68326 data-v-c8dd2045><!--[--><span data-v-c8dd2045>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guogao-doc/markdown-examples.html" tabindex="0" data-v-88d68326 data-v-c8dd2045><!--[--><span data-v-c8dd2045>Examples</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guogao-doc/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E6%95%99%E7%A8%8B.html" tabindex="0" data-v-88d68326 data-v-c8dd2045><!--[--><span data-v-c8dd2045>快速上手教程</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guogao-doc/%E5%9F%B9%E8%AE%AD%E8%AF%9D%E6%9C%AF-%E5%AE%8C%E6%95%B4%E7%89%88.html" tabindex="0" data-v-88d68326 data-v-c8dd2045><!--[--><span data-v-c8dd2045>Examples2</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-438b78f0 data-v-039e315e><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-039e315e data-v-d16b7b8a data-v-b7e5a6d9><span class="check" data-v-b7e5a6d9><span class="icon" data-v-b7e5a6d9><!--[--><span class="vpi-sun sun" data-v-d16b7b8a></span><span class="vpi-moon moon" data-v-d16b7b8a></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-438b78f0 data-v-1fb4275b data-v-4594f90c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-4594f90c data-v-9d5268b0><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-438b78f0 data-v-15ce5b99 data-v-4b10ab9f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-4b10ab9f><span class="vpi-more-horizontal icon" data-v-4b10ab9f></span></button><div class="menu" data-v-4b10ab9f><div class="VPMenu" data-v-4b10ab9f data-v-18661181><!----><!--[--><!--[--><!----><div class="group" data-v-15ce5b99><div class="item appearance" data-v-15ce5b99><p class="label" data-v-15ce5b99>Appearance</p><div class="appearance-action" data-v-15ce5b99><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-15ce5b99 data-v-d16b7b8a data-v-b7e5a6d9><span class="check" data-v-b7e5a6d9><span class="icon" data-v-b7e5a6d9><!--[--><span class="vpi-sun sun" data-v-d16b7b8a></span><span class="vpi-moon moon" data-v-d16b7b8a></span><!--]--></span></span></button></div></div></div><div class="group" data-v-15ce5b99><div class="item social-links" data-v-15ce5b99><div class="VPSocialLinks social-links-list" data-v-15ce5b99 data-v-4594f90c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-4594f90c data-v-9d5268b0><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-438b78f0 data-v-1d2167b6><span class="container" data-v-1d2167b6><span class="top" data-v-1d2167b6></span><span class="middle" data-v-1d2167b6></span><span class="bottom" data-v-1d2167b6></span></span></button></div></div></div></div><div class="divider" data-v-438b78f0><div class="divider-line" data-v-438b78f0></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-4813dc16 data-v-1dad4ac0><div class="container" data-v-1dad4ac0><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-1dad4ac0><span class="vpi-align-left menu-icon" data-v-1dad4ac0></span><span class="menu-text" data-v-1dad4ac0>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-1dad4ac0 data-v-f4ff6604><button data-v-f4ff6604>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-4813dc16 data-v-2cffcfb5><div class="curtain" data-v-2cffcfb5></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-2cffcfb5><span class="visually-hidden" id="sidebar-aria-label" data-v-2cffcfb5> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-ad0e979a><section class="VPSidebarItem level-0" data-v-ad0e979a data-v-35fdcd38><div class="item" role="button" tabindex="0" data-v-35fdcd38><div class="indicator" data-v-35fdcd38></div><h2 class="text" data-v-35fdcd38>Examples</h2><!----></div><div class="items" data-v-35fdcd38><!--[--><div class="VPSidebarItem level-1 is-link" data-v-35fdcd38 data-v-35fdcd38><div class="item" data-v-35fdcd38><div class="indicator" data-v-35fdcd38></div><a class="VPLink link link" href="/guogao-doc/markdown-examples.html" data-v-35fdcd38><!--[--><p class="text" data-v-35fdcd38>Markdown Examples</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-35fdcd38 data-v-35fdcd38><div class="item" data-v-35fdcd38><div class="indicator" data-v-35fdcd38></div><a class="VPLink link link" href="/guogao-doc/api-examples.html" data-v-35fdcd38><!--[--><p class="text" data-v-35fdcd38>Runtime API Examples</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-4813dc16 data-v-97402932><div class="VPDoc has-sidebar has-aside" data-v-97402932 data-v-28ef3a16><!--[--><!--]--><div class="container" data-v-28ef3a16><div class="aside" data-v-28ef3a16><div class="aside-curtain" data-v-28ef3a16></div><div class="aside-container" data-v-28ef3a16><div class="aside-content" data-v-28ef3a16><div class="VPDocAside" data-v-28ef3a16 data-v-46a306fe><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-46a306fe data-v-56286fd3><div class="content" data-v-56286fd3><div class="outline-marker" data-v-56286fd3></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-56286fd3>目录</div><ul class="VPDocOutlineItem root" data-v-56286fd3 data-v-c624256b><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-46a306fe></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-28ef3a16><div class="content-container" data-v-28ef3a16><!--[--><!--]--><main class="main" data-v-28ef3a16><div style="position:relative;" class="vp-doc _guogao-doc_Claude_Code_%E5%9F%B9%E8%AE%AD%E6%95%99%E7%A8%8B" data-v-28ef3a16><div><h1 id="🎓-claude-code-培训教程" tabindex="-1">🎓 Claude Code 培训教程 <a class="header-anchor" href="#🎓-claude-code-培训教程" aria-label="Permalink to &quot;🎓 Claude Code 培训教程&quot;">​</a></h1><p><strong>适用对象</strong>：用过 Claude Code 但不熟练的开发者 <strong>学习时长</strong>：2-3 小时自学 或 半天集中培训 <strong>最后更新</strong>：2025-10-13</p><hr><h2 id="📑-目录" tabindex="-1">📑 目录 <a class="header-anchor" href="#📑-目录" aria-label="Permalink to &quot;📑 目录&quot;">​</a></h2><ol><li><a href="#第一部分理念篇">理念篇：为什么需要结构化提示词</a></li><li><a href="#第二部分基础篇">基础篇：掌握核心语法</a></li><li><a href="#第三部分实战篇">实战篇：4个完整案例</a></li><li><a href="#第四部分进阶篇">进阶篇：提升协作效率</a></li><li><a href="#第五部分避坑篇">避坑篇：常见错误与纠正</a></li><li><a href="#第六部分练习篇">练习篇：巩固学习成果</a></li></ol><hr><h2 id="第一部分-理念篇" tabindex="-1">第一部分：理念篇 <a class="header-anchor" href="#第一部分-理念篇" aria-label="Permalink to &quot;第一部分：理念篇&quot;">​</a></h2><h3 id="_1-1-claude-code-协作的核心理念" tabindex="-1">1.1 Claude Code 协作的核心理念 <a class="header-anchor" href="#_1-1-claude-code-协作的核心理念" aria-label="Permalink to &quot;1.1 Claude Code 协作的核心理念&quot;">​</a></h3><h4 id="传统方式-vs-结构化方式" tabindex="-1">传统方式 vs 结构化方式 <a class="header-anchor" href="#传统方式-vs-结构化方式" aria-label="Permalink to &quot;传统方式 vs 结构化方式&quot;">​</a></h4><p><strong>❌ 传统方式（低效）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>开发者：&quot;帮我写一个订单功能&quot;</span></span>
<span class="line"><span>AI：生成大量代码</span></span>
<span class="line"><span>开发者：发现不符合需求</span></span>
<span class="line"><span>AI：重新生成</span></span>
<span class="line"><span>开发者：又发现新问题</span></span>
<span class="line"><span>...（反复多轮，浪费大量 token）</span></span></code></pre></div><p><strong>✅ 结构化方式（高效）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>开发者：讨论需求，不要写代码（分析阶段）</span></span>
<span class="line"><span>AI：理解需求，提出方案</span></span>
<span class="line"><span>开发者：确认方案（设计阶段）</span></span>
<span class="line"><span>AI：复述需求确认</span></span>
<span class="line"><span>开发者：开始编码（实施阶段）</span></span>
<span class="line"><span>AI：一次性生成符合预期的代码</span></span></code></pre></div><h4 id="核心理念-三段式工作流" tabindex="-1">核心理念：三段式工作流 <a class="header-anchor" href="#核心理念-三段式工作流" aria-label="Permalink to &quot;核心理念：三段式工作流&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────┐</span></span>
<span class="line"><span>│  分析阶段（Analysis）                    │</span></span>
<span class="line"><span>│  目标：理解现状、评估可行性               │</span></span>
<span class="line"><span>│  关键词：解释、分析、评估、不要写代码      │</span></span>
<span class="line"><span>├─────────────────────────────────────────┤</span></span>
<span class="line"><span>│  设计阶段（Design）                      │</span></span>
<span class="line"><span>│  目标：制定方案、确认需求                 │</span></span>
<span class="line"><span>│  关键词：讨论、对比、复述、制定计划       │</span></span>
<span class="line"><span>├─────────────────────────────────────────┤</span></span>
<span class="line"><span>│  实施阶段（Implementation）              │</span></span>
<span class="line"><span>│  目标：编写代码、分步执行                 │</span></span>
<span class="line"><span>│  关键词：采用方案X、开始编码、继续下一步  │</span></span>
<span class="line"><span>└─────────────────────────────────────────┘</span></span></code></pre></div><h4 id="为什么这样更高效" tabindex="-1">为什么这样更高效？ <a class="header-anchor" href="#为什么这样更高效" aria-label="Permalink to &quot;为什么这样更高效？&quot;">​</a></h4><ol><li><strong>减少返工</strong>：先确认理解，再动手编码</li><li><strong>节省 token</strong>：避免生成大量无用代码</li><li><strong>提高质量</strong>：充分的方案讨论避免设计缺陷</li><li><strong>易于维护</strong>：清晰的步骤记录便于后续追溯</li></ol><hr><h3 id="_1-2-三个模板文件的定位和关系" tabindex="-1">1.2 三个模板文件的定位和关系 <a class="header-anchor" href="#_1-2-三个模板文件的定位和关系" aria-label="Permalink to &quot;1.2 三个模板文件的定位和关系&quot;">​</a></h3><h4 id="三个文件概览" tabindex="-1">三个文件概览 <a class="header-anchor" href="#三个文件概览" aria-label="Permalink to &quot;三个文件概览&quot;">​</a></h4><table tabindex="0"><thead><tr><th>文件名</th><th>定位</th><th>使用场景</th><th>特点</th></tr></thead><tbody><tr><td><strong>提示词模板优化版</strong></td><td>基础工具箱</td><td>日常各种开发任务</td><td>40+ 原子操作模板</td></tr><tr><td><strong>流程化提示词</strong></td><td>端到端流程</td><td>完整功能开发</td><td>8 个完整工作流</td></tr><tr><td><strong>业务逻辑增加模板</strong></td><td>专项场景</td><td>在现有代码中加逻辑</td><td>深入到具体步骤</td></tr></tbody></table><h4 id="它们的关系" tabindex="-1">它们的关系 <a class="header-anchor" href="#它们的关系" aria-label="Permalink to &quot;它们的关系&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>        提示词模板优化版（基础）</span></span>
<span class="line"><span>              ↓ 提供原子操作</span></span>
<span class="line"><span>        流程化提示词（组合）</span></span>
<span class="line"><span>              ↓ 特化为具体场景</span></span>
<span class="line"><span>        业务逻辑增加模板（专项）</span></span></code></pre></div><p><strong>类比理解</strong>：</p><ul><li><strong>提示词模板优化版</strong> = 乐高积木（基础组件）</li><li><strong>流程化提示词</strong> = 乐高说明书（如何组装成飞机、城堡）</li><li><strong>业务逻辑增加模板</strong> = 专项改装指南（如何给城堡加个塔楼）</li></ul><hr><h3 id="_1-3-如何根据场景选择正确的模板" tabindex="-1">1.3 如何根据场景选择正确的模板 <a class="header-anchor" href="#_1-3-如何根据场景选择正确的模板" aria-label="Permalink to &quot;1.3 如何根据场景选择正确的模板&quot;">​</a></h3><h4 id="决策树-30秒快速判断" tabindex="-1">决策树（30秒快速判断） <a class="header-anchor" href="#决策树-30秒快速判断" aria-label="Permalink to &quot;决策树（30秒快速判断）&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. 你要做什么？</span></span>
<span class="line"><span>   ├─ 在现有函数/接口中加逻辑</span></span>
<span class="line"><span>   │   → 使用《业务逻辑增加模板》</span></span>
<span class="line"><span>   │</span></span>
<span class="line"><span>   ├─ 开发完整的新功能、重构、修Bug</span></span>
<span class="line"><span>   │   → 使用《流程化提示词》</span></span>
<span class="line"><span>   │</span></span>
<span class="line"><span>   └─ 单次操作（改个命名、加个注释、查询代码）</span></span>
<span class="line"><span>       → 使用《提示词模板优化版》</span></span></code></pre></div><h4 id="典型场景映射表" tabindex="-1">典型场景映射表 <a class="header-anchor" href="#典型场景映射表" aria-label="Permalink to &quot;典型场景映射表&quot;">​</a></h4><table tabindex="0"><thead><tr><th>场景</th><th>推荐使用</th><th>原因</th></tr></thead><tbody><tr><td>订单接口需要增加会员判断逻辑</td><td>业务逻辑增加模板</td><td>现有函数插入新逻辑</td></tr><tr><td>开发新的支付模块</td><td>流程化提示词 → 新功能开发流程</td><td>从0到1的完整流程</td></tr><tr><td>重构混乱的代码</td><td>流程化提示词 → 代码重构流程</td><td>有明确的分析→设计→实施步骤</td></tr><tr><td>修复线上Bug</td><td>流程化提示词 → Bug修复流程</td><td>需要根因分析</td></tr><tr><td>修改一个变量名</td><td>提示词模板优化版 → 批量重命名</td><td>简单操作</td></tr><tr><td>理解某个函数的逻辑</td><td>提示词模板优化版 → 理解现有代码</td><td>分析任务</td></tr><tr><td>设计新的API接口</td><td>流程化提示词 → API设计流程</td><td>需要完整的设计阶段</td></tr><tr><td>给函数返回结构加个字段</td><td>业务逻辑增加模板 → 场景2</td><td>修改现有接口</td></tr></tbody></table><h4 id="组合使用示例" tabindex="-1">组合使用示例 <a class="header-anchor" href="#组合使用示例" aria-label="Permalink to &quot;组合使用示例&quot;">​</a></h4><p><strong>场景</strong>：开发新功能后发现性能问题</p><ol><li><strong>第1阶段</strong>：使用《流程化提示词 - 新功能开发流程》完成基本功能</li><li><strong>第2阶段</strong>：使用《流程化提示词 - 性能优化流程》优化慢接口</li><li><strong>收尾</strong>：使用《提示词模板优化版 - 生成文档》输出API文档</li></ol><hr><h2 id="第二部分-基础篇" tabindex="-1">第二部分：基础篇 <a class="header-anchor" href="#第二部分-基础篇" aria-label="Permalink to &quot;第二部分：基础篇&quot;">​</a></h2><h3 id="_2-1-核心语法和符号说明" tabindex="-1">2.1 核心语法和符号说明 <a class="header-anchor" href="#_2-1-核心语法和符号说明" aria-label="Permalink to &quot;2.1 核心语法和符号说明&quot;">​</a></h3><h4 id="必须掌握的5个核心语法" tabindex="-1">必须掌握的5个核心语法 <a class="header-anchor" href="#必须掌握的5个核心语法" aria-label="Permalink to &quot;必须掌握的5个核心语法&quot;">​</a></h4><p><strong>1. @ 文件引用符</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用途：精确引用文件或代码段</span></span>
<span class="line"><span></span></span>
<span class="line"><span>语法：</span></span>
<span class="line"><span>@文件路径                    # 引用整个文件</span></span>
<span class="line"><span>@文件路径#L50                # 引用第50行</span></span>
<span class="line"><span>@文件路径#L50-80             # 引用50到80行</span></span>
<span class="line"><span></span></span>
<span class="line"><span>示例：</span></span>
<span class="line"><span>@api/v1/order.go</span></span>
<span class="line"><span>@service/user.go#L100-150</span></span>
<span class="line"><span>@model/function.go#L20</span></span></code></pre></div><p><strong>为什么要用@引用？</strong></p><ul><li>❌ 错误：「在订单文件的第100行左右那个函数」（模糊）</li><li>✅ 正确：<code>@service/order.go#L100-120</code>（精确）</li></ul><p><strong>2. / 命令符</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/clear          # 清空上下文（切换任务时使用）</span></span>
<span class="line"><span>/repeat         # 批量操作（如全局重命名）</span></span>
<span class="line"><span>/think          # 深度思考模式（复杂问题）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>使用时机：</span></span>
<span class="line"><span>/clear    → 开始新任务、上下文超过50轮、混乱时</span></span>
<span class="line"><span>/repeat   → 需要在多个文件中执行相同操作</span></span>
<span class="line"><span>/think    → 复杂架构设计、难以抉择的方案选择</span></span></code></pre></div><p><strong>3. 关键修饰符</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&quot;不要写代码&quot;    # 仅分析讨论，不生成代码（分析/设计阶段）</span></span>
<span class="line"><span>&quot;先说明&quot;        # 先给出方案，等确认后再执行（复杂修改前）</span></span>
<span class="line"><span>&quot;think hard&quot;    # 启用深度推理（架构设计、疑难问题）</span></span>
<span class="line"><span>&quot;直接修改&quot;      # 跳过讨论，立即执行（简单操作）</span></span></code></pre></div><p><strong>4. 占位符约定</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>{文件}     → api/v1/user.go</span></span>
<span class="line"><span>{行号}     → #L100-120 或 #L50</span></span>
<span class="line"><span>{功能}     → 订单创建逻辑</span></span>
<span class="line"><span>{模块}     → user_benefit</span></span>
<span class="line"><span>{方案X}    → 方案1 / 方案A</span></span>
<span class="line"><span>{字段}     → OrderTypeID</span></span>
<span class="line"><span>{操作}     → 重构 / 合并 / 优化</span></span></code></pre></div><p><strong>5. 阶段标识</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【需求背景】、【功能目标】、【技术要求】  → 结构化描述</span></span>
<span class="line"><span>- [ ] 待办事项                         → 清单</span></span>
<span class="line"><span>方案A / 方案B                          → 方案对比</span></span></code></pre></div><hr><h3 id="_2-2-三段式工作流详解" tabindex="-1">2.2 三段式工作流详解 <a class="header-anchor" href="#_2-2-三段式工作流详解" aria-label="Permalink to &quot;2.2 三段式工作流详解&quot;">​</a></h3><h4 id="阶段一-分析阶段-analysis" tabindex="-1">阶段一：分析阶段（Analysis） <a class="header-anchor" href="#阶段一-分析阶段-analysis" aria-label="Permalink to &quot;阶段一：分析阶段（Analysis）&quot;">​</a></h4><p><strong>目标</strong>：理解现状、评估可行性、避免盲目动手</p><p><strong>核心模板</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@{文件}{行号} 解释一下{功能逻辑}，不要写代码</span></span></code></pre></div><p><strong>示例</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@api/v1/order.go#L50-100 解释一下订单创建的完整流程，不要写代码</span></span></code></pre></div><p><strong>AI会输出</strong>：</p><ul><li>当前代码的核心逻辑</li><li>关键步骤分解</li><li>边界条件处理</li><li>潜在问题点</li></ul><p><strong>你的判断</strong>：</p><ul><li>是否理解准确？</li><li>是否有遗漏？</li><li>是否需要查看更多代码？</li></ul><p><strong>常见错误</strong>：</p><ul><li>❌ 没有分析就直接要求修改</li><li>❌ 描述不清晰就让AI猜测</li><li>✅ 先让AI复述现状，确认理解一致</li></ul><hr><h4 id="阶段二-设计阶段-design" tabindex="-1">阶段二：设计阶段（Design） <a class="header-anchor" href="#阶段二-设计阶段-design" aria-label="Permalink to &quot;阶段二：设计阶段（Design）&quot;">​</a></h4><p><strong>目标</strong>：制定方案、对比优劣、确认需求</p><p><strong>核心模板</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>讨论需求，不要写代码</span></span>
<span class="line"><span>{详细需求描述}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>有没有更好的方案，不要写代码</span></span>
<span class="line"><span></span></span>
<span class="line"><span>请复述以下需求，确认理解无误，不要写代码</span></span>
<span class="line"><span>{需求描述}</span></span></code></pre></div><p><strong>示例</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>讨论需求，不要写代码</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【当前功能】</span></span>
<span class="line"><span>订单创建接口，按统一价格扣费</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【需要增加的逻辑】</span></span>
<span class="line"><span>- 场景1：免费功能，直接创建订单</span></span>
<span class="line"><span>- 场景2：付费功能，优先扣免费次数</span></span>
<span class="line"><span>- 场景3：无免费次数，会员按会员价</span></span>
<span class="line"><span>- 场景4：非会员按原价</span></span>
<span class="line"><span></span></span>
<span class="line"><span>有没有更好的方案，不要写代码</span></span></code></pre></div><p><strong>AI会输出</strong>：</p><ul><li>方案A、方案B、方案C</li><li>每个方案的优缺点</li><li>推荐方案及理由</li></ul><p><strong>你的决策</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>采用方案B，请详细说明实施步骤，不要写代码</span></span></code></pre></div><p><strong>常见错误</strong>：</p><ul><li>❌ 没有方案对比就直接编码</li><li>❌ 没有复述确认就开始实施</li><li>✅ 充分讨论后再决策</li></ul><hr><h4 id="阶段三-实施阶段-implementation" tabindex="-1">阶段三：实施阶段（Implementation） <a class="header-anchor" href="#阶段三-实施阶段-implementation" aria-label="Permalink to &quot;阶段三：实施阶段（Implementation）&quot;">​</a></h4><p><strong>目标</strong>：编写代码、分步执行、及时确认</p><p><strong>核心模板</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>采用方案{X}，开始编码</span></span>
<span class="line"><span></span></span>
<span class="line"><span>要求：</span></span>
<span class="line"><span>- 遵循 CLAUDE.md 规范</span></span>
<span class="line"><span>- 参考 {模块} 的风格</span></span>
<span class="line"><span>- 每完成一层暂停</span></span></code></pre></div><p><strong>示例</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>采用方案B，开始编码</span></span>
<span class="line"><span></span></span>
<span class="line"><span>要求：</span></span>
<span class="line"><span>- 遵循 CLAUDE.md 中的代码风格</span></span>
<span class="line"><span>- 参考 user_benefit 模块的分层方式</span></span>
<span class="line"><span>- 先完成 Service 层，完成后暂停</span></span></code></pre></div><p><strong>分步确认</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>AI: [完成 Service 层]</span></span>
<span class="line"><span>你: ok，继续 API 层</span></span>
<span class="line"><span></span></span>
<span class="line"><span>或者</span></span>
<span class="line"><span>你: Service 层需要调整：</span></span>
<span class="line"><span>    @service/order.go#L50 这里应该先判断功能类型</span></span>
<span class="line"><span>    调整后继续 API 层</span></span></code></pre></div><p><strong>常见错误</strong>：</p><ul><li>❌ 一次性要求完成所有层，出错后难以定位</li><li>❌ 没有明确编码规范，风格不统一</li><li>✅ 分层实施，每层确认后继续</li></ul><hr><h3 id="_2-3-关键修饰符的使用时机" tabindex="-1">2.3 关键修饰符的使用时机 <a class="header-anchor" href="#_2-3-关键修饰符的使用时机" aria-label="Permalink to &quot;2.3 关键修饰符的使用时机&quot;">​</a></h3><h4 id="不要写代码-的3个使用场景" tabindex="-1">&quot;不要写代码&quot;的3个使用场景 <a class="header-anchor" href="#不要写代码-的3个使用场景" aria-label="Permalink to &quot;&quot;不要写代码&quot;的3个使用场景&quot;">​</a></h4><p><strong>场景1：需求分析阶段</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@service/order.go#L50-150</span></span>
<span class="line"><span>分析当前的订单创建逻辑，不要写代码</span></span></code></pre></div><p><strong>为什么</strong>：先理解再动手，避免理解偏差</p><p><strong>场景2：方案设计阶段</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>讨论需求，不要写代码</span></span>
<span class="line"><span>{需求描述}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>请对比以下方案，不要写代码</span></span>
<span class="line"><span>方案A：{描述}</span></span>
<span class="line"><span>方案B：{描述}</span></span></code></pre></div><p><strong>为什么</strong>：充分讨论选出最优方案</p><p><strong>场景3：制定计划阶段</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>制定 todo 清单，不要写代码</span></span></code></pre></div><p><strong>为什么</strong>：先规划后执行，避免遗漏</p><hr><h4 id="先说明-的使用场景" tabindex="-1">&quot;先说明&quot;的使用场景 <a class="header-anchor" href="#先说明-的使用场景" aria-label="Permalink to &quot;&quot;先说明&quot;的使用场景&quot;">​</a></h4><p><strong>场景：复杂修改前的预演</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@service/order.go#L80-120</span></span>
<span class="line"><span>在「校验用户权限」和「创建订单记录」之间插入免费次数判断逻辑</span></span>
<span class="line"><span></span></span>
<span class="line"><span>先说明：</span></span>
<span class="line"><span>1. 插入的具体位置（第几行之后）</span></span>
<span class="line"><span>2. 是否需要提取为独立函数</span></span>
<span class="line"><span>3. 是否需要修改变量传递</span></span>
<span class="line"><span></span></span>
<span class="line"><span>不要写代码</span></span></code></pre></div><p><strong>AI会输出</strong>：</p><ul><li>详细的插入方案</li><li>潜在的影响</li><li>建议的代码结构</li></ul><p><strong>你确认后</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>方案合理，按上述方案开始修改</span></span></code></pre></div><hr><h4 id="think-hard-的使用场景" tabindex="-1">&quot;think hard&quot;的使用场景 <a class="header-anchor" href="#think-hard-的使用场景" aria-label="Permalink to &quot;&quot;think hard&quot;的使用场景&quot;">​</a></h4><p><strong>场景1：架构设计</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/think 根据四种计费场景，设计统一的订单创建架构，think hard</span></span>
<span class="line"><span></span></span>
<span class="line"><span>要求：</span></span>
<span class="line"><span>- 支持未来新增更多计费场景</span></span>
<span class="line"><span>- 保持代码可维护性</span></span>
<span class="line"><span>- 性能不能有明显下降</span></span></code></pre></div><p><strong>场景2：疑难问题</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/think 分析为什么并发时会出现免费次数扣减不一致的问题，think hard</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【问题现象】</span></span>
<span class="line"><span>{详细描述}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【相关代码】</span></span>
<span class="line"><span>@service/benefit.go#L50-80</span></span></code></pre></div><hr><h3 id="_2-4-上下文管理策略" tabindex="-1">2.4 上下文管理策略 <a class="header-anchor" href="#_2-4-上下文管理策略" aria-label="Permalink to &quot;2.4 上下文管理策略&quot;">​</a></h3><h4 id="何时使用-clear" tabindex="-1">何时使用 /clear <a class="header-anchor" href="#何时使用-clear" aria-label="Permalink to &quot;何时使用 /clear&quot;">​</a></h4><p><strong>✅ 应该清空的场景</strong></p><ul><li>切换到完全不相关的任务</li><li>上下文超过 50 轮对话（性能下降）</li><li>AI 开始混淆之前的内容（出现错乱）</li><li>开始新的流程（如从Bug修复切换到新功能开发）</li></ul><p><strong>❌ 不应该清空的场景</strong></p><ul><li>任务进行中（会丢失上下文）</li><li>仅仅是换了个文件（同一任务的不同模块）</li><li>AI 给出的结果不满意（应该纠正，不是清空）</li></ul><h4 id="清空后如何快速恢复" tabindex="-1">清空后如何快速恢复 <a class="header-anchor" href="#清空后如何快速恢复" aria-label="Permalink to &quot;清空后如何快速恢复&quot;">​</a></h4><p><strong>方法1：任务摘要恢复</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/clear</span></span>
<span class="line"><span></span></span>
<span class="line"><span>继续 {流程名称}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【上次进度】</span></span>
<span class="line"><span>- 已完成：Model 层开发、Service 层开发</span></span>
<span class="line"><span>- 当前：需要继续 API 层</span></span>
<span class="line"><span>- 关键决策：采用方案B（统一订单入口）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>请先复述上次的关键决策，然后继续 API 层开发</span></span></code></pre></div><p><strong>方法2：利用项目文件恢复</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/clear</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@WORKFLOW.md 中记录了当前任务进度</span></span>
<span class="line"><span>@CLAUDE.md 中有项目的代码规范</span></span>
<span class="line"><span></span></span>
<span class="line"><span>继续当前任务</span></span></code></pre></div><hr><h2 id="第三部分-实战篇" tabindex="-1">第三部分：实战篇 <a class="header-anchor" href="#第三部分-实战篇" aria-label="Permalink to &quot;第三部分：实战篇&quot;">​</a></h2><h3 id="_3-1-场景1-简单业务逻辑增加-完整演示" tabindex="-1">3.1 场景1：简单业务逻辑增加（完整演示） <a class="header-anchor" href="#_3-1-场景1-简单业务逻辑增加-完整演示" aria-label="Permalink to &quot;3.1 场景1：简单业务逻辑增加（完整演示）&quot;">​</a></h3><h4 id="场景描述" tabindex="-1">场景描述 <a class="header-anchor" href="#场景描述" aria-label="Permalink to &quot;场景描述&quot;">​</a></h4><p>在用户信息接口中，如果用户是会员，额外返回会员等级和过期时间。</p><h4 id="复杂度评估" tabindex="-1">复杂度评估 <a class="header-anchor" href="#复杂度评估" aria-label="Permalink to &quot;复杂度评估&quot;">​</a></h4><p>🟢 简单：单个判断分支、不影响原逻辑、无数据库变更</p><h4 id="完整对话流程" tabindex="-1">完整对话流程 <a class="header-anchor" href="#完整对话流程" aria-label="Permalink to &quot;完整对话流程&quot;">​</a></h4><p><strong>第1轮：理解现状 + 设计方案</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@api/v1/user.go#L50-80</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【当前功能】</span></span>
<span class="line"><span>获取用户信息接口，返回基本资料</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【需要增加的逻辑】</span></span>
<span class="line"><span>如果用户是会员，额外返回会员等级和过期时间</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【触发条件】</span></span>
<span class="line"><span>- 用户表的 is_member 字段为 true 时</span></span>
<span class="line"><span>- 不影响非会员用户的原有返回</span></span>
<span class="line"><span></span></span>
<span class="line"><span>请先：</span></span>
<span class="line"><span>1. 复述当前函数的核心逻辑</span></span>
<span class="line"><span>2. 说明新逻辑应该插入的位置</span></span>
<span class="line"><span>3. 给出代码修改建议</span></span>
<span class="line"><span></span></span>
<span class="line"><span>不要写代码</span></span></code></pre></div><p><strong>AI 回复示例</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【当前逻辑复述】</span></span>
<span class="line"><span>1. 从 context 获取用户ID</span></span>
<span class="line"><span>2. 查询 user 表获取基本信息</span></span>
<span class="line"><span>3. 组装返回结构体 UserInfoResponse</span></span>
<span class="line"><span>4. 返回 JSON 响应</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【新逻辑插入位置】</span></span>
<span class="line"><span>在第2步「查询用户信息」和第3步「组装返回」之间</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【代码修改建议】</span></span>
<span class="line"><span>1. 在返回结构体 UserInfoResponse 中新增字段：</span></span>
<span class="line"><span>   - MemberLevel int `json:&quot;member_level,omitempty&quot;`</span></span>
<span class="line"><span>   - MemberExpireAt string `json:&quot;member_expire_at,omitempty&quot;`</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2. 在组装返回数据时，增加判断：</span></span>
<span class="line"><span>   if user.IsMember {</span></span>
<span class="line"><span>       response.MemberLevel = user.MemberLevel</span></span>
<span class="line"><span>       response.MemberExpireAt = user.MemberExpireAt.Format(&quot;2006-01-02&quot;)</span></span>
<span class="line"><span>   }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【影响分析】</span></span>
<span class="line"><span>- 不影响非会员用户（使用 omitempty 标签）</span></span>
<span class="line"><span>- 不需要修改数据库</span></span>
<span class="line"><span>- 不需要修改函数签名</span></span></code></pre></div><p><strong>第2轮：确认并开始修改</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>方案合理，采用上述方案，开始修改</span></span>
<span class="line"><span></span></span>
<span class="line"><span>要求：</span></span>
<span class="line"><span>- 遵循 CLAUDE.md 规范</span></span>
<span class="line"><span>- 保持原有代码风格</span></span>
<span class="line"><span>- 添加注释说明新增逻辑</span></span></code></pre></div><p><strong>AI 执行修改</strong> （AI会修改对应文件）</p><p><strong>第3轮：验证</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>看起来不错，请列出测试要点</span></span></code></pre></div><p><strong>AI 回复测试清单</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【测试场景】</span></span>
<span class="line"><span>1. 会员用户：应返回 member_level 和 member_expire_at</span></span>
<span class="line"><span>2. 非会员用户：不返回这两个字段</span></span>
<span class="line"><span>3. 会员过期用户：需确认 is_member 字段的值</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【测试建议】</span></span>
<span class="line"><span>使用 Postman 或 curl 分别测试三种用户类型</span></span></code></pre></div><h4 id="关键要点总结" tabindex="-1">关键要点总结 <a class="header-anchor" href="#关键要点总结" aria-label="Permalink to &quot;关键要点总结&quot;">​</a></h4><p>✅ <strong>做对了什么</strong></p><ul><li>先理解现状，再设计方案</li><li>明确触发条件和影响范围</li><li>使用 omitempty 保持向后兼容</li><li>分步执行，每步确认</li></ul><p>❌ <strong>如果不用结构化提示词</strong></p><ul><li>可能直接改错位置</li><li>可能忘记处理向后兼容</li><li>可能影响非会员用户</li><li>返工成本高</li></ul><hr><h3 id="_3-2-场景2-中等复杂度需求开发-关键节点讲解" tabindex="-1">3.2 场景2：中等复杂度需求开发（关键节点讲解） <a class="header-anchor" href="#_3-2-场景2-中等复杂度需求开发-关键节点讲解" aria-label="Permalink to &quot;3.2 场景2：中等复杂度需求开发（关键节点讲解）&quot;">​</a></h3><h4 id="场景描述-1" tabindex="-1">场景描述 <a class="header-anchor" href="#场景描述-1" aria-label="Permalink to &quot;场景描述&quot;">​</a></h4><p>订单创建功能需要支持四种计费场景：</p><ol><li>免费功能直接创建</li><li>付费功能优先扣免费次数</li><li>无免费次数的会员按会员价</li><li>非会员按原价</li></ol><h4 id="复杂度评估-1" tabindex="-1">复杂度评估 <a class="header-anchor" href="#复杂度评估-1" aria-label="Permalink to &quot;复杂度评估&quot;">​</a></h4><p>🟡 中等：多个判断条件、需修改原逻辑、可能需加字段</p><h4 id="关键对话节点-简化版" tabindex="-1">关键对话节点（简化版） <a class="header-anchor" href="#关键对话节点-简化版" aria-label="Permalink to &quot;关键对话节点（简化版）&quot;">​</a></h4><p><strong>阶段1：现状分析（第1轮）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@service/order.go#L50-150</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【目标函数/接口】</span></span>
<span class="line"><span>CreateOrder - 创建订单</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【新业务需求】</span></span>
<span class="line"><span>增加四种计费场景的判断逻辑：</span></span>
<span class="line"><span>- 场景1：免费功能，直接创建订单，扣减免费次数</span></span>
<span class="line"><span>- 场景2：付费功能，用户有免费次数，扣减次数</span></span>
<span class="line"><span>- 场景3：付费功能，用户无免费次数但是会员，按会员价创建订单</span></span>
<span class="line"><span>- 场景4：付费功能，用户无免费次数且非会员，按原价创建订单</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【业务规则】</span></span>
<span class="line"><span>- 规则1：优先消耗免费次数</span></span>
<span class="line"><span>- 规则2：会员价格与原价相同时，视为无会员优惠</span></span>
<span class="line"><span>- 规则3：免费次数不足时，不能部分扣减</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【相关数据】</span></span>
<span class="line"><span>- 需要读取：function 表（价格、会员价格、免费次数）、user 表（会员状态）、user_function_usage 表（已使用次数）</span></span>
<span class="line"><span>- 需要写入：order 表、user_function_usage 表</span></span>
<span class="line"><span></span></span>
<span class="line"><span>请分析：</span></span>
<span class="line"><span>1. 当前函数的完整逻辑流程</span></span>
<span class="line"><span>2. 新逻辑应该如何融入现有流程</span></span>
<span class="line"><span>3. 是否需要修改数据库表结构</span></span>
<span class="line"><span>4. 是否需要修改函数签名</span></span>
<span class="line"><span>5. 对原有调用方的影响</span></span>
<span class="line"><span></span></span>
<span class="line"><span>不要写代码</span></span></code></pre></div><p><strong>阶段2：插入点设计（第2轮）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>基于以上分析，请详细设计新逻辑的插入方案，不要写代码</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【函数分解】</span></span>
<span class="line"><span>- 原有逻辑保留的部分：{步骤列表}</span></span>
<span class="line"><span>- 需要修改的部分：{步骤列表}</span></span>
<span class="line"><span>- 新增的部分：{步骤列表}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【插入策略】</span></span>
<span class="line"><span>方案A：在函数内部直接插入（适合逻辑简单）</span></span>
<span class="line"><span>方案B：提取为独立子函数后调用（适合逻辑复杂）</span></span>
<span class="line"><span>方案C：使用策略模式/责任链模式（适合多分支）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>推荐方案并说明理由</span></span></code></pre></div><p><strong>阶段3：确认不需要数据库变更（第3轮）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>确认不需要数据库变更，跳过此步骤，继续下一步</span></span></code></pre></div><p><strong>阶段4：Service 层实施（第4轮）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>采用方案B，开始修改 Service 层</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【修改范围】</span></span>
<span class="line"><span>@service/order.go#L50-150</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【修改要求】</span></span>
<span class="line"><span>- 提取计费场景判断为独立函数 determineBillingScenario()</span></span>
<span class="line"><span>- 保持原有代码风格</span></span>
<span class="line"><span>- 添加详细注释说明四种场景</span></span>
<span class="line"><span>- 错误处理与原函数保持一致</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【特别注意】</span></span>
<span class="line"><span>- 需要事务保证免费次数扣减和订单创建的一致性</span></span>
<span class="line"><span></span></span>
<span class="line"><span>仅修改 Service 层，修改完成后暂停</span></span></code></pre></div><p><strong>阶段5：验证清单（第5轮）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>请生成测试验证清单，不要写测试代码</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【功能测试】</span></span>
<span class="line"><span>- 场景1：{输入} → {预期输出}</span></span>
<span class="line"><span>- 场景2：{输入} → {预期输出}</span></span>
<span class="line"><span>- 场景3：{输入} → {预期输出}</span></span>
<span class="line"><span>- 场景4：{输入} → {预期输出}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【边界测试】</span></span>
<span class="line"><span>- 并发场景：两个用户同时使用最后一次免费次数</span></span>
<span class="line"><span>- 数据为空：功能配置不存在</span></span>
<span class="line"><span>- 异常情况：数据库写入失败时的回滚</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【回归测试】</span></span>
<span class="line"><span>- 原有功能是否受影响：现有订单创建流程</span></span></code></pre></div><h4 id="关键要点总结-1" tabindex="-1">关键要点总结 <a class="header-anchor" href="#关键要点总结-1" aria-label="Permalink to &quot;关键要点总结&quot;">​</a></h4><p>✅ <strong>中等复杂度的特点</strong></p><ul><li>需要详细的方案设计阶段</li><li>需要明确插入策略（直接插入 vs 提取函数）</li><li>需要考虑事务、并发等边界条件</li><li>建议分层实施，Service 层和 API 层分开</li></ul><p>⚠️ <strong>容易踩的坑</strong></p><ul><li>没有评估并发安全（免费次数可能超扣）</li><li>没有考虑事务（订单创建成功但次数扣减失败）</li><li>忘记处理边界条件（价格配置不存在）</li></ul><hr><h3 id="_3-3-场景3-bug修复全流程-错误案例对比" tabindex="-1">3.3 场景3：Bug修复全流程（错误案例对比） <a class="header-anchor" href="#_3-3-场景3-bug修复全流程-错误案例对比" aria-label="Permalink to &quot;3.3 场景3：Bug修复全流程（错误案例对比）&quot;">​</a></h3><h4 id="场景描述-2" tabindex="-1">场景描述 <a class="header-anchor" href="#场景描述-2" aria-label="Permalink to &quot;场景描述&quot;">​</a></h4><p>生产环境发现并发情况下，用户免费次数会被超额扣减。</p><h4 id="错误案例-直接猜测和修改" tabindex="-1">错误案例：直接猜测和修改 <a class="header-anchor" href="#错误案例-直接猜测和修改" aria-label="Permalink to &quot;错误案例：直接猜测和修改&quot;">​</a></h4><p><strong>❌ 错误的对话方式</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>开发者：免费次数扣减有问题，帮我加个锁</span></span>
<span class="line"><span>AI：在哪个位置加锁？</span></span>
<span class="line"><span>开发者：就是扣次数的地方</span></span>
<span class="line"><span>AI：[随便找了个地方加锁]</span></span>
<span class="line"><span>开发者：还是有问题...</span></span></code></pre></div><p><strong>问题</strong>：</p><ul><li>没有分析根因，盲目修改</li><li>没有复现步骤，无法验证</li><li>可能引入新问题（如死锁）</li></ul><hr><h4 id="正确案例-结构化bug修复流程" tabindex="-1">正确案例：结构化Bug修复流程 <a class="header-anchor" href="#正确案例-结构化bug修复流程" aria-label="Permalink to &quot;正确案例：结构化Bug修复流程&quot;">​</a></h4><p><strong>阶段1：问题复现（第1轮）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/clear</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【Bug 描述】</span></span>
<span class="line"><span>并发情况下，用户的免费次数会被超额扣减</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【复现步骤】</span></span>
<span class="line"><span>1. 用户 A 有 1 次免费次数</span></span>
<span class="line"><span>2. 用户 A 同时发起 2 个订单请求</span></span>
<span class="line"><span>3. 两个订单都创建成功，但免费次数变成 -1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【预期行为】</span></span>
<span class="line"><span>只有第1个请求应该扣减免费次数成功，第2个请求应该走付费逻辑</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【实际行为】</span></span>
<span class="line"><span>两个请求都扣减了免费次数，导致余额为负</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【错误日志】</span></span>
<span class="line"><span>user_id: 123, free_count before: 1, after: -1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【相关代码】</span></span>
<span class="line"><span>@service/order.go#L80-120</span></span>
<span class="line"><span>@service/benefit.go#L50-80</span></span>
<span class="line"><span></span></span>
<span class="line"><span>请分析可能的原因，不要写代码</span></span></code></pre></div><p><strong>AI 回复</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【可能原因分析】</span></span>
<span class="line"><span></span></span>
<span class="line"><span>最可能的原因：缺少并发控制</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【问题根源】</span></span>
<span class="line"><span>1. 第1个请求读取 free_count = 1</span></span>
<span class="line"><span>2. 第2个请求也读取 free_count = 1（此时第1个请求还未写入）</span></span>
<span class="line"><span>3. 两个请求都判断 free_count &gt; 0</span></span>
<span class="line"><span>4. 两个请求都执行扣减操作</span></span>
<span class="line"><span>5. 最终 free_count = 1 - 1 - 1 = -1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【需要查看的关键代码】</span></span>
<span class="line"><span>benefit.go 中的次数扣减逻辑</span></span></code></pre></div><p><strong>阶段2：根因分析（第2轮）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>请查看 @service/benefit.go#L50-80，确认是否是这个问题</span></span></code></pre></div><p><strong>AI 确认</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【根因确认】</span></span>
<span class="line"><span>确认是并发问题，代码流程：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>1. 查询当前免费次数（SELECT free_count）</span></span>
<span class="line"><span>2. 判断是否 &gt; 0</span></span>
<span class="line"><span>3. 扣减次数（UPDATE free_count = free_count - 1）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【问题】</span></span>
<span class="line"><span>第1步和第3步之间没有加锁，导致并发时两个请求都读到相同的值</span></span></code></pre></div><p><strong>阶段3：修复方案（第3轮）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>确认根因是并发导致的超扣</span></span>
<span class="line"><span></span></span>
<span class="line"><span>请给出修复方案，不要写代码</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【修复方式对比】</span></span>
<span class="line"><span>方案1：{快速修复方案}</span></span>
<span class="line"><span>方案2：{彻底解决方案}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>对比：</span></span>
<span class="line"><span>- 修复彻底性</span></span>
<span class="line"><span>- 引入新问题的风险</span></span>
<span class="line"><span>- 工作量</span></span>
<span class="line"><span>- 是否需要回归测试</span></span>
<span class="line"><span></span></span>
<span class="line"><span>推荐方案并说明理由</span></span></code></pre></div><p><strong>AI 回复</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【方案对比】</span></span>
<span class="line"><span></span></span>
<span class="line"><span>方案1：悲观锁（SELECT ... FOR UPDATE）</span></span>
<span class="line"><span>优点：实现简单，数据强一致</span></span>
<span class="line"><span>缺点：性能稍差，持有锁时间较长</span></span>
<span class="line"><span></span></span>
<span class="line"><span>方案2：乐观锁（WHERE free_count &gt; 0）</span></span>
<span class="line"><span>优点：性能好，无锁竞争</span></span>
<span class="line"><span>缺点：需要检查 affected_rows，逻辑稍复杂</span></span>
<span class="line"><span></span></span>
<span class="line"><span>方案3：Redis 分布式锁</span></span>
<span class="line"><span>优点：性能最好</span></span>
<span class="line"><span>缺点：引入外部依赖，复杂度高</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【推荐方案1】</span></span>
<span class="line"><span>理由：</span></span>
<span class="line"><span>- 数据库本身支持，无外部依赖</span></span>
<span class="line"><span>- 免费次数扣减不是高频操作，性能可接受</span></span>
<span class="line"><span>- 彻底解决并发问题，无风险</span></span></code></pre></div><p><strong>阶段4：实施修复（第4轮）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>采用方案1，开始修复</span></span>
<span class="line"><span></span></span>
<span class="line"><span>要求：</span></span>
<span class="line"><span>- 最小化改动范围</span></span>
<span class="line"><span>- 添加必要的日志</span></span>
<span class="line"><span>- 补充并发场景的注释</span></span></code></pre></div><p><strong>阶段5：验证测试（第5轮）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>请为此 Bug 生成测试用例，确保不会再复现</span></span>
<span class="line"><span></span></span>
<span class="line"><span>1. 原问题场景测试</span></span>
<span class="line"><span>2. 边界条件测试</span></span>
<span class="line"><span>3. 回归测试场景</span></span></code></pre></div><p><strong>AI 输出测试方案</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【并发测试】</span></span>
<span class="line"><span>使用 goroutine 模拟 10 个并发请求，验证次数扣减正确</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【边界测试】</span></span>
<span class="line"><span>1. 免费次数为 0 时并发请求</span></span>
<span class="line"><span>2. 免费次数为 1 时并发 2 个请求</span></span>
<span class="line"><span>3. 免费次数为 5 时并发 10 个请求</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【回归测试】</span></span>
<span class="line"><span>1. 单个请求正常扣减</span></span>
<span class="line"><span>2. 非并发场景不受影响</span></span></code></pre></div><h4 id="关键要点总结-2" tabindex="-1">关键要点总结 <a class="header-anchor" href="#关键要点总结-2" aria-label="Permalink to &quot;关键要点总结&quot;">​</a></h4><p>✅ <strong>结构化Bug修复的优势</strong></p><ul><li>精确定位根因，避免盲目修改</li><li>方案对比，选择最优解</li><li>最小化改动，降低风险</li><li>完整的测试覆盖，确保不复现</li></ul><p>⚠️ <strong>Bug修复常见错误</strong></p><ul><li>没有复现步骤就开始改</li><li>没有根因分析就猜测</li><li>改完没有回归测试</li><li>改动范围过大引入新问题</li></ul><hr><h3 id="_3-4-场景4-代码重构实践-方案选择技巧" tabindex="-1">3.4 场景4：代码重构实践（方案选择技巧） <a class="header-anchor" href="#_3-4-场景4-代码重构实践-方案选择技巧" aria-label="Permalink to &quot;3.4 场景4：代码重构实践（方案选择技巧）&quot;">​</a></h3><h4 id="场景描述-3" tabindex="-1">场景描述 <a class="header-anchor" href="#场景描述-3" aria-label="Permalink to &quot;场景描述&quot;">​</a></h4><p>一个 200 行的订单创建函数，包含大量 if-else，逻辑混乱，需要重构。</p><h4 id="完整流程-简化版" tabindex="-1">完整流程（简化版） <a class="header-anchor" href="#完整流程-简化版" aria-label="Permalink to &quot;完整流程（简化版）&quot;">​</a></h4><p><strong>阶段1：现状分析（第1轮）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/clear</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@service/order.go#L50-250</span></span>
<span class="line"><span></span></span>
<span class="line"><span>分析以上代码存在的问题，不要写代码</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【代码质量】</span></span>
<span class="line"><span>- 代码重复度</span></span>
<span class="line"><span>- 圈复杂度</span></span>
<span class="line"><span>- 命名规范</span></span>
<span class="line"><span>- 注释完整性</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【架构问题】</span></span>
<span class="line"><span>- 分层是否合理</span></span>
<span class="line"><span>- 职责是否清晰</span></span>
<span class="line"><span>- 依赖关系是否复杂</span></span>
<span class="line"><span></span></span>
<span class="line"><span>按严重程度排序，给出改进建议</span></span></code></pre></div><p><strong>阶段2：参考学习（第2轮）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>请读取 user_benefit 模块的代码，分析其优秀实践，不要写代码</span></span>
<span class="line"><span></span></span>
<span class="line"><span>重点关注：</span></span>
<span class="line"><span>- 分层设计（Model/Service/API 的职责划分）</span></span>
<span class="line"><span>- 命名规范（结构体/函数/变量的命名方式）</span></span>
<span class="line"><span>- 错误处理（统一的错误处理模式）</span></span>
<span class="line"><span>- 代码复用（公共逻辑的提取方式）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>总结成可执行的重构原则</span></span></code></pre></div><p><strong>阶段3：重构方案（第3轮）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>基于以上问题分析和参考模块，设计重构方案，不要写代码</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【方案对比】</span></span>
<span class="line"><span>方案A：渐进式重构（保持向后兼容，逐步迁移）</span></span>
<span class="line"><span>方案B：彻底重构（不保持兼容，一次性改造）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>对比维度：</span></span>
<span class="line"><span>- 工作量</span></span>
<span class="line"><span>- 风险</span></span>
<span class="line"><span>- 业务影响</span></span>
<span class="line"><span>- 上线策略</span></span>
<span class="line"><span></span></span>
<span class="line"><span>推荐方案并说明理由</span></span></code></pre></div><p><strong>AI 回复示例</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【方案对比】</span></span>
<span class="line"><span></span></span>
<span class="line"><span>方案A：渐进式重构</span></span>
<span class="line"><span>步骤：</span></span>
<span class="line"><span>1. 提取公共函数，原函数调用新函数</span></span>
<span class="line"><span>2. 逐步迁移调用方到新接口</span></span>
<span class="line"><span>3. 废弃旧接口</span></span>
<span class="line"><span></span></span>
<span class="line"><span>优点：风险低，可随时回滚</span></span>
<span class="line"><span>缺点：工作量大，需维护两套代码</span></span>
<span class="line"><span></span></span>
<span class="line"><span>方案B：彻底重构</span></span>
<span class="line"><span>步骤：</span></span>
<span class="line"><span>1. 重新设计函数结构</span></span>
<span class="line"><span>2. 使用策略模式替代 if-else</span></span>
<span class="line"><span>3. 一次性替换</span></span>
<span class="line"><span></span></span>
<span class="line"><span>优点：代码最清晰，工作量相对小</span></span>
<span class="line"><span>缺点：风险高，需要充分测试</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【推荐方案A】</span></span>
<span class="line"><span>理由：</span></span>
<span class="line"><span>- 订单创建是核心功能，不能有闪失</span></span>
<span class="line"><span>- 线上有大量调用方，难以一次性迁移</span></span>
<span class="line"><span>- 渐进式重构可以分批上线，降低风险</span></span></code></pre></div><p><strong>阶段4：分步实施（第4-N轮）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>采用方案A，按以下顺序重构，每步完成后暂停</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【第1步：提取常量和配置】</span></span>
<span class="line"><span>@service/order.go#L60,L80,L100,L150</span></span>
<span class="line"><span>将这些硬编码的值提取为常量</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【第2步：提取计费逻辑】</span></span>
<span class="line"><span>@service/order.go#L100-180</span></span>
<span class="line"><span>将计费逻辑提取为独立函数 calculateOrderAmount()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【第3步：提取次数扣减逻辑】</span></span>
<span class="line"><span>@service/order.go#L80-100</span></span>
<span class="line"><span>将次数扣减提取为独立函数 deductFreeCount()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【第4步：重构主函数】</span></span>
<span class="line"><span>使用提取的函数重构 CreateOrder()</span></span></code></pre></div><p>每步确认：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ok，继续第2步</span></span></code></pre></div><h4 id="关键要点总结-3" tabindex="-1">关键要点总结 <a class="header-anchor" href="#关键要点总结-3" aria-label="Permalink to &quot;关键要点总结&quot;">​</a></h4><p>✅ <strong>重构方案选择技巧</strong></p><ul><li>核心功能优先选择渐进式重构（风险低）</li><li>边缘功能可选择彻底重构（效率高）</li><li>有大量外部调用的接口必须考虑兼容性</li><li>参考优秀模块的实践，保持风格统一</li></ul><p>⚠️ <strong>重构常见错误</strong></p><ul><li>没有参考现有代码风格，重构后不统一</li><li>改动范围过大，难以测试</li><li>没有分步实施，出问题难以定位</li><li>忘记更新调用方</li></ul><hr><h2 id="第四部分-进阶篇" tabindex="-1">第四部分：进阶篇 <a class="header-anchor" href="#第四部分-进阶篇" aria-label="Permalink to &quot;第四部分：进阶篇&quot;">​</a></h2><h3 id="_4-1-流程组合使用技巧" tabindex="-1">4.1 流程组合使用技巧 <a class="header-anchor" href="#_4-1-流程组合使用技巧" aria-label="Permalink to &quot;4.1 流程组合使用技巧&quot;">​</a></h3><h4 id="组合模式1-新功能-性能优化" tabindex="-1">组合模式1：新功能 + 性能优化 <a class="header-anchor" href="#组合模式1-新功能-性能优化" aria-label="Permalink to &quot;组合模式1：新功能 + 性能优化&quot;">​</a></h4><p><strong>场景</strong>：开发一个数据分析接口，上线后发现响应时间过长</p><p><strong>流程组合</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>阶段1：使用【新功能开发流程】完成基本功能</span></span>
<span class="line"><span>  ↓</span></span>
<span class="line"><span>阶段2：使用【性能优化流程】优化慢接口</span></span>
<span class="line"><span>  - 发现问题：数据库查询慢</span></span>
<span class="line"><span>  - 优化方案：添加索引 + Redis 缓存</span></span>
<span class="line"><span>  ↓</span></span>
<span class="line"><span>阶段3：使用【提示词模板 - 生成文档】输出 API 文档</span></span></code></pre></div><p><strong>具体对话</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 阶段1</span></span>
<span class="line"><span>/clear</span></span>
<span class="line"><span>使用【新功能开发流程】</span></span>
<span class="line"><span>...（按流程完成开发）</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 阶段2</span></span>
<span class="line"><span>/clear</span></span>
<span class="line"><span>使用【性能优化流程】</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【性能问题】</span></span>
<span class="line"><span>接口响应时间 &gt; 2s，期望 &lt; 500ms</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【问题代码】</span></span>
<span class="line"><span>@api/v1/analytics.go#L50-100</span></span>
<span class="line"><span></span></span>
<span class="line"><span>请分析性能瓶颈，不要写代码</span></span>
<span class="line"><span>...（按流程优化）</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 阶段3</span></span>
<span class="line"><span>@api/v1/analytics.go 生成 OpenAPI 3.0 文档</span></span></code></pre></div><hr><h4 id="组合模式2-bug修复-代码重构" tabindex="-1">组合模式2：Bug修复 + 代码重构 <a class="header-anchor" href="#组合模式2-bug修复-代码重构" aria-label="Permalink to &quot;组合模式2：Bug修复 + 代码重构&quot;">​</a></h4><p><strong>场景</strong>：修复Bug时发现代码质量差，需要顺便重构</p><p><strong>流程组合</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>阶段1：使用【Bug修复流程】快速止血</span></span>
<span class="line"><span>  - 最小化改动</span></span>
<span class="line"><span>  - 快速上线</span></span>
<span class="line"><span>  ↓</span></span>
<span class="line"><span>阶段2：使用【代码重构流程】解决深层问题</span></span>
<span class="line"><span>  - 提取重复逻辑</span></span>
<span class="line"><span>  - 降低复杂度</span></span>
<span class="line"><span>  - 补充测试</span></span></code></pre></div><p><strong>关键点</strong>：</p><ul><li>先修Bug（紧急）</li><li>再重构（重要但不紧急）</li><li>两个阶段用 /clear 分隔，避免混淆</li></ul><hr><h4 id="组合模式3-业务逻辑增加-api设计" tabindex="-1">组合模式3：业务逻辑增加 + API设计 <a class="header-anchor" href="#组合模式3-业务逻辑增加-api设计" aria-label="Permalink to &quot;组合模式3：业务逻辑增加 + API设计&quot;">​</a></h4><p><strong>场景</strong>：在现有订单功能中增加退款逻辑，需要提供新接口</p><p><strong>流程组合</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>阶段1：使用【业务逻辑增加模板 - 中等复杂度】</span></span>
<span class="line"><span>  - 在 CreateOrder 中增加退款标识判断</span></span>
<span class="line"><span>  ↓</span></span>
<span class="line"><span>阶段2：使用【API设计流程】</span></span>
<span class="line"><span>  - 设计退款接口 /api/order/refund</span></span>
<span class="line"><span>  - 复用 Service 层逻辑</span></span></code></pre></div><hr><h3 id="_4-2-多人协作场景处理" tabindex="-1">4.2 多人协作场景处理 <a class="header-anchor" href="#_4-2-多人协作场景处理" aria-label="Permalink to &quot;4.2 多人协作场景处理&quot;">​</a></h3><h4 id="场景-前后端分离开发" tabindex="-1">场景：前后端分离开发 <a class="header-anchor" href="#场景-前后端分离开发" aria-label="Permalink to &quot;场景：前后端分离开发&quot;">​</a></h4><p><strong>问题</strong>：后端接口还未开发完成，前端需要联调</p><p><strong>解决方案</strong>：生成 Mock 数据和接口文档</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【任务分配】</span></span>
<span class="line"><span>- 我负责：后端 API 开发</span></span>
<span class="line"><span>- 前端同事负责：页面开发</span></span>
<span class="line"><span>- 需要联调的接口：/api/function/detail</span></span>
<span class="line"><span></span></span>
<span class="line"><span>请为我生成：</span></span>
<span class="line"><span>1. 接口设计文档（给前端同事）</span></span>
<span class="line"><span>2. Mock 数据示例（前端本地测试用）</span></span>
<span class="line"><span>3. 我的开发任务清单</span></span>
<span class="line"><span></span></span>
<span class="line"><span>不要写代码</span></span></code></pre></div><p><strong>AI 输出</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【接口设计文档】</span></span>
<span class="line"><span>## GET /api/function/detail</span></span>
<span class="line"><span></span></span>
<span class="line"><span>请求参数：</span></span>
<span class="line"><span>- function_key (string, required): 功能标识</span></span>
<span class="line"><span></span></span>
<span class="line"><span>响应结构：</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  &quot;code&quot;: 0,</span></span>
<span class="line"><span>  &quot;data&quot;: {</span></span>
<span class="line"><span>    &quot;function_key&quot;: &quot;ai_writer&quot;,</span></span>
<span class="line"><span>    &quot;name&quot;: &quot;AI写作助手&quot;,</span></span>
<span class="line"><span>    &quot;price&quot;: 100,</span></span>
<span class="line"><span>    &quot;member_price&quot;: 80,</span></span>
<span class="line"><span>    &quot;free_count&quot;: 5,</span></span>
<span class="line"><span>    &quot;billing_scenario&quot;: 1-4</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【Mock 数据】</span></span>
<span class="line"><span>{会员场景、非会员场景、免费场景的完整 Mock 数据}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【我的任务清单】</span></span>
<span class="line"><span>1. 实现 Service 层的 GetFunctionDetail 方法</span></span>
<span class="line"><span>2. 实现 API 层的路由和控制器</span></span>
<span class="line"><span>3. 补充单元测试</span></span></code></pre></div><hr><h4 id="场景-团队代码规范统一" tabindex="-1">场景：团队代码规范统一 <a class="header-anchor" href="#场景-团队代码规范统一" aria-label="Permalink to &quot;场景：团队代码规范统一&quot;">​</a></h4><p><strong>问题</strong>：团队中每个人写的代码风格不一致</p><p><strong>解决方案</strong>：建立项目 CLAUDE.md 规范文件</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>读取以下优秀模块的代码，提取团队代码规范到 CLAUDE.md：</span></span>
<span class="line"><span>@service/user_benefit.go</span></span>
<span class="line"><span>@api/v1/user_benefit.go</span></span>
<span class="line"><span>@model/user_benefit.go</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【规范内容】</span></span>
<span class="line"><span>- 分层职责（Model/Service/API 各层的职责边界）</span></span>
<span class="line"><span>- 命名规范（文件/结构体/函数/变量/常量）</span></span>
<span class="line"><span>- 注释风格（函数注释/业务逻辑注释）</span></span>
<span class="line"><span>- 错误处理（统一的错误返回方式）</span></span>
<span class="line"><span>- 参数校验（在哪一层做校验）</span></span>
<span class="line"><span>- 日志记录（何时记录日志）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>生成后，团队所有代码都遵循此规范</span></span></code></pre></div><p><strong>后续使用</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>采用方案A，开始编码</span></span>
<span class="line"><span></span></span>
<span class="line"><span>要求：</span></span>
<span class="line"><span>- 严格遵循 CLAUDE.md 中的规范</span></span>
<span class="line"><span>- 参考 user_benefit 模块的风格</span></span></code></pre></div><hr><h3 id="_4-3-复杂项目的上下文管理" tabindex="-1">4.3 复杂项目的上下文管理 <a class="header-anchor" href="#_4-3-复杂项目的上下文管理" aria-label="Permalink to &quot;4.3 复杂项目的上下文管理&quot;">​</a></h3><h4 id="策略1-使用-workflow-md-记录进度" tabindex="-1">策略1：使用 WORKFLOW.md 记录进度 <a class="header-anchor" href="#策略1-使用-workflow-md-记录进度" aria-label="Permalink to &quot;策略1：使用 WORKFLOW.md 记录进度&quot;">​</a></h4><p><strong>文件结构</strong>：</p><div class="language-markdown vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">markdown</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;"># 当前任务</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">## 2025-10-13: 实现功能计费模块</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">### 进度</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-light-text-decoration:underline;--shiki-dark:#DBEDFF;--shiki-dark-text-decoration:underline;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] 需求分析</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-light-text-decoration:underline;--shiki-dark:#DBEDFF;--shiki-dark-text-decoration:underline;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] 方案设计（采用方案B：统一订单入口）</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ ] 编码实施 (进行中)</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-light-text-decoration:underline;--shiki-dark:#DBEDFF;--shiki-dark-text-decoration:underline;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] Model 层</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-light-text-decoration:underline;--shiki-dark:#DBEDFF;--shiki-dark-text-decoration:underline;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] Service 层</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ ] API 层</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ ] 测试</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">### 关键决策</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 采用方案B：提取计费逻辑为独立函数</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 使用事务保证次数扣减和订单创建的一致性</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 会员价与原价相同时不展示会员标签</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">### 待办</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ ] 完成 API 层开发</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ ] 补充 Service 层单元测试</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ ] 生成 API 文档</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ ] 更新前端接口调用</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">### 遗留问题</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 并发情况下的性能测试（待下周进行）</span></span></code></pre></div><p><strong>使用方式</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 任务中断时</span></span>
<span class="line"><span>请将当前进度更新到 WORKFLOW.md</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 任务恢复时</span></span>
<span class="line"><span>/clear</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@WORKFLOW.md 中记录了当前任务进度</span></span>
<span class="line"><span>继续当前任务</span></span>
<span class="line"><span></span></span>
<span class="line"><span>请先复述：</span></span>
<span class="line"><span>1. 当前进度</span></span>
<span class="line"><span>2. 关键决策</span></span>
<span class="line"><span>3. 下一步要做什么</span></span></code></pre></div><hr><h4 id="策略2-分模块管理上下文" tabindex="-1">策略2：分模块管理上下文 <a class="header-anchor" href="#策略2-分模块管理上下文" aria-label="Permalink to &quot;策略2：分模块管理上下文&quot;">​</a></h4><p><strong>问题</strong>：一个大功能涉及多个模块，单个会话无法完成</p><p><strong>解决方案</strong>：按模块分次对话，使用文件串联</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 第1次对话：完成 Model 层</span></span>
<span class="line"><span>/clear</span></span>
<span class="line"><span>开发 Function 模块的 Model 层</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>请将 Model 层的设计要点记录到 DESIGN.md</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 第2次对话：完成 Service 层</span></span>
<span class="line"><span>/clear</span></span>
<span class="line"><span>@DESIGN.md 中有 Model 层的设计</span></span>
<span class="line"><span>继续开发 Service 层</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>请更新 DESIGN.md，补充 Service 层设计</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 第3次对话：完成 API 层</span></span>
<span class="line"><span>/clear</span></span>
<span class="line"><span>@DESIGN.md 中有前两层的设计</span></span>
<span class="line"><span>继续开发 API 层</span></span></code></pre></div><hr><h4 id="策略3-定期整理和归档" tabindex="-1">策略3：定期整理和归档 <a class="header-anchor" href="#策略3-定期整理和归档" aria-label="Permalink to &quot;策略3：定期整理和归档&quot;">​</a></h4><p><strong>每完成一个大功能后</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>请生成本次开发的总结文档：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【功能概述】</span></span>
<span class="line"><span>简单描述实现的功能</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【关键决策】</span></span>
<span class="line"><span>列出重要的技术选型和方案决策</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【代码变更】</span></span>
<span class="line"><span>列出新增/修改/删除的文件</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【测试要点】</span></span>
<span class="line"><span>列出需要重点测试的场景</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【遗留问题】</span></span>
<span class="line"><span>列出未解决的问题和优化点</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【经验教训】</span></span>
<span class="line"><span>记录踩过的坑和最佳实践</span></span>
<span class="line"><span></span></span>
<span class="line"><span>输出到 docs/功能计费模块开发总结.md</span></span></code></pre></div><hr><h3 id="_4-4-建立项目专属规范-claude-md" tabindex="-1">4.4 建立项目专属规范（CLAUDE.md） <a class="header-anchor" href="#_4-4-建立项目专属规范-claude-md" aria-label="Permalink to &quot;4.4 建立项目专属规范（CLAUDE.md）&quot;">​</a></h3><h4 id="claude-md-的作用" tabindex="-1">CLAUDE.md 的作用 <a class="header-anchor" href="#claude-md-的作用" aria-label="Permalink to &quot;CLAUDE.md 的作用&quot;">​</a></h4><ol><li><strong>统一团队代码风格</strong>：所有 AI 生成的代码都遵循相同规范</li><li><strong>减少沟通成本</strong>：不用每次都说明要求</li><li><strong>保持代码一致性</strong>：新功能自动遵循现有风格</li><li><strong>知识沉淀</strong>：记录项目特有的最佳实践</li></ol><hr><h4 id="claude-md-模板" tabindex="-1">CLAUDE.md 模板 <a class="header-anchor" href="#claude-md-模板" aria-label="Permalink to &quot;CLAUDE.md 模板&quot;">​</a></h4><div class="language-markdown vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">markdown</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;"># 项目代码规范</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">## 分层职责</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">### Model 层</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 职责：仅负责数据库操作，不包含业务逻辑</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 风格：使用结构体方法，不使用包级函数</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 命名：方法名使用 Get/Create/Update/Delete 前缀</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">示例：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">```go</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">func (f *Function) GetByKey(key string) (*Function, error)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">func (f *Function) Create() error</span></span></code></pre></div><h3 id="service-层" tabindex="-1">Service 层 <a class="header-anchor" href="#service-层" aria-label="Permalink to &quot;Service 层&quot;">​</a></h3><ul><li>职责：业务逻辑处理，调用 Model 层</li><li>风格：复杂逻辑提取为私有函数</li><li>错误处理：统一使用 pkg/errors 包装错误</li></ul><p>示例：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GetFunctionDetail</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">functionKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FunctionDetail</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. 获取用户信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> service.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetUserInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(c)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. 查询功能信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    function, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetByKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(functionKey)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Wrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;查询功能失败&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3. 判断计费场景</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    scenario </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> determineBillingScenario</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(user, function)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FunctionDetail</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="api-层" tabindex="-1">API 层 <a class="header-anchor" href="#api-层" aria-label="Permalink to &quot;API 层&quot;">​</a></h3><ul><li>职责：参数校验 + 响应组装，不包含业务逻辑</li><li>风格：控制器方法简洁，所有逻辑移到 Service 层</li><li>响应格式：统一使用 response.Success() 和 response.Error()</li></ul><h2 id="命名规范" tabindex="-1">命名规范 <a class="header-anchor" href="#命名规范" aria-label="Permalink to &quot;命名规范&quot;">​</a></h2><ul><li>文件名：snake_case（user_benefit.go）</li><li>结构体：PascalCase（UserBenefit）</li><li>函数：导出 PascalCase，私有 camelCase</li><li>常量：UPPER_SNAKE_CASE（MAX_FREE_COUNT）</li><li>变量：camelCase（userInfo）</li></ul><h2 id="注释规范" tabindex="-1">注释规范 <a class="header-anchor" href="#注释规范" aria-label="Permalink to &quot;注释规范&quot;">​</a></h2><ul><li>导出函数必须有注释</li><li>复杂业务逻辑必须有注释说明</li><li>注释格式：// FunctionName 功能说明</li></ul><h2 id="错误处理" tabindex="-1">错误处理 <a class="header-anchor" href="#错误处理" aria-label="Permalink to &quot;错误处理&quot;">​</a></h2><ul><li>Service 层返回业务错误：errors.New(&quot;用户余额不足&quot;)</li><li>API 层转换为 HTTP 状态码：400/403/404/500</li><li>统一使用 pkg/errors 包装错误，保留堆栈信息</li></ul><h2 id="常量定义" tabindex="-1">常量定义 <a class="header-anchor" href="#常量定义" aria-label="Permalink to &quot;常量定义&quot;">​</a></h2><ul><li>所有魔法数字必须定义为常量</li><li>常量统一定义在 conf/var.go</li><li>使用 const 分组定义</li></ul><h2 id="数据库操作" tabindex="-1">数据库操作 <a class="header-anchor" href="#数据库操作" aria-label="Permalink to &quot;数据库操作&quot;">​</a></h2><ul><li>涉及多表操作必须使用事务</li><li>使用 GORM 的钩子方法（BeforeCreate/AfterCreate）</li><li>查询使用结构体方法，不使用原生 SQL</li></ul><h2 id="缓存策略" tabindex="-1">缓存策略 <a class="header-anchor" href="#缓存策略" aria-label="Permalink to &quot;缓存策略&quot;">​</a></h2><ul><li>使用 Redis 作为缓存</li><li id="">缓存 key 统一前缀：project_name:{module}:</li><li>过期时间：热点数据 30 分钟，普通数据 5 分钟</li></ul><h2 id="测试要求" tabindex="-1">测试要求 <a class="header-anchor" href="#测试要求" aria-label="Permalink to &quot;测试要求&quot;">​</a></h2><ul><li>核心业务逻辑必须有单元测试</li><li>测试文件命名：xxx_test.go</li><li>使用 testify 包的 assert</li></ul><h2 id="项目特有规范" tabindex="-1">项目特有规范 <a class="header-anchor" href="#项目特有规范" aria-label="Permalink to &quot;项目特有规范&quot;">​</a></h2><ul><li>用户信息统一通过 service.GetUserInfo(c) 获取</li><li>会员判断统一通过 user.IsMember() 方法</li><li>日志统一使用 logrus，格式：log.WithFields(...)</li></ul><h2 id="常见陷阱" tabindex="-1">常见陷阱 <a class="header-anchor" href="#常见陷阱" aria-label="Permalink to &quot;常见陷阱&quot;">​</a></h2><ul><li>❌ 不要在 Model 层写业务逻辑</li><li>❌ 不要在 API 层直接调用 Model</li><li>❌ 不要使用 panic，统一返回 error</li><li>❌ 不要在循环中查询数据库</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#### 如何使用 CLAUDE.md</span></span>
<span class="line"><span></span></span>
<span class="line"><span>**方式1：每次编码时引用**</span></span></code></pre></div><p>采用方案A，开始编码</p><p>要求：</p><ul><li>严格遵循 CLAUDE.md 中的规范</li><li>参考 user_benefit 模块的实现方式</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>**方式2：让 AI 自动遵循**</span></span></code></pre></div><p>从现在起，所有代码都遵循 @CLAUDE.md 中的规范</p><p>开始开发订单模块</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>**方式3：检查现有代码是否符合规范**</span></span></code></pre></div><p>@service/order.go</p><p>对照 @CLAUDE.md 中的规范，检查此文件是否有不符合的地方</p><p>不要修改，只输出问题清单</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>## 第五部分：避坑篇</span></span>
<span class="line"><span></span></span>
<span class="line"><span>### 5.1 十个最常见错误及纠正方法</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#### 错误1：没有理解原有逻辑就修改</span></span>
<span class="line"><span></span></span>
<span class="line"><span>**症状**：修改后发现破坏了原有功能</span></span>
<span class="line"><span></span></span>
<span class="line"><span>**错误示例**：</span></span></code></pre></div><p>开发者：@service/order.go#L50-150 帮我在这里加个会员判断逻辑</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>**AI**：（没有理解原逻辑就直接修改）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>**后果**：可能插入位置不对、变量未初始化、破坏原有流程</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>**正确做法**：</span></span></code></pre></div><p>@service/order.go#L50-150</p><p>请先解释当前函数的完整逻辑，包括：</p><ul><li>输入输出</li><li>核心步骤</li><li>边界条件处理</li></ul><p>不要写代码</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>**AI 理解后**：</span></span></code></pre></div><p>理解正确，现在在{具体步骤}之后插入会员判断逻辑</p><p 详细的插入要求=""></p><p>开始修改</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#### 错误2：插入位置描述不清晰</span></span>
<span class="line"><span></span></span>
<span class="line"><span>**症状**：新逻辑用到的变量还未初始化，或插入后破坏了原有顺序</span></span>
<span class="line"><span></span></span>
<span class="line"><span>**错误示例**：</span></span></code></pre></div><p>开发者：在订单创建的中间位置加个判断</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>**问题**：「中间位置」太模糊，AI 只能猜测</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>**正确做法**：</span></span></code></pre></div><p>@service/order.go#L80-120</p><p>在「校验用户权限」(第85行)和「创建订单记录」(第100行)之间插入以下逻辑： 检查用户免费次数，如果有免费次数则扣减，无免费次数则计算应付金额</p><p>需要访问的数据：user_benefit 表的 free_count 字段 插入后对后续步骤的影响：原来直接计算价格，现在要先判断是否免费</p><p>请先说明：</p><ol><li>插入的具体位置（第几行之后）</li><li>是否需要提取为独立函数</li><li>是否需要修改变量传递</li></ol><p>不要写代码</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#### 错误3：忽略并发安全</span></span>
<span class="line"><span></span></span>
<span class="line"><span>**症状**：多用户同时操作时出现数据不一致</span></span>
<span class="line"><span></span></span>
<span class="line"><span>**错误示例**：</span></span></code></pre></div><p>开发者：帮我实现扣减免费次数的逻辑</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>**AI 生成**：</span></span>
<span class="line"><span>```go</span></span>
<span class="line"><span>// 查询次数</span></span>
<span class="line"><span>count := getUserFreeCount(userID)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// 判断</span></span>
<span class="line"><span>if count &gt; 0 {</span></span>
<span class="line"><span>    // 扣减</span></span>
<span class="line"><span>    updateFreeCount(userID, count-1)</span></span>
<span class="line"><span>}</span></span></code></pre></div><p><strong>问题</strong>：并发时两个请求都读到 count=1，导致超扣</p><hr><p><strong>正确做法</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@service/benefit.go#L50-80</span></span>
<span class="line"><span></span></span>
<span class="line"><span>实现扣减免费次数的逻辑</span></span>
<span class="line"><span></span></span>
<span class="line"><span>涉及读-判断-写操作，必须说明并发安全方案：</span></span>
<span class="line"><span>- 是否需要事务</span></span>
<span class="line"><span>- 是否需要加锁（悲观锁/乐观锁）</span></span>
<span class="line"><span>- 如何处理并发扣减失败的情况</span></span>
<span class="line"><span></span></span>
<span class="line"><span>先给出方案，不要写代码</span></span></code></pre></div><p><strong>AI 方案</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【推荐方案：悲观锁】</span></span>
<span class="line"><span>使用 SELECT ... FOR UPDATE 锁定记录</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【实施步骤】</span></span>
<span class="line"><span>1. 开启事务</span></span>
<span class="line"><span>2. SELECT free_count FROM user_benefit WHERE user_id = ? FOR UPDATE</span></span>
<span class="line"><span>3. 判断 free_count &gt; 0</span></span>
<span class="line"><span>4. UPDATE free_count = free_count - 1</span></span>
<span class="line"><span>5. 提交事务</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【并发处理】</span></span>
<span class="line"><span>- 第2个请求会等待第1个事务提交</span></span>
<span class="line"><span>- 读到的一定是最新值</span></span></code></pre></div><hr><h4 id="错误4-忘记错误处理" tabindex="-1">错误4：忘记错误处理 <a class="header-anchor" href="#错误4-忘记错误处理" aria-label="Permalink to &quot;错误4：忘记错误处理&quot;">​</a></h4><p><strong>症状</strong>：新增的查询/计算出错时未处理，导致系统异常</p><p><strong>错误示例</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>开发者：在订单创建时查询功能价格</span></span></code></pre></div><p><strong>AI 生成</strong>：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">function </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetByKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(functionKey)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">order.Price </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> function.Price</span></span></code></pre></div><p><strong>问题</strong>：如果功能不存在，function 为 nil，会 panic</p><hr><p><strong>正确做法</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>在订单创建时查询功能价格</span></span>
<span class="line"><span></span></span>
<span class="line"><span>要求：</span></span>
<span class="line"><span>- 错误处理与原函数保持一致</span></span>
<span class="line"><span>- 如果原函数返回 error，新逻辑也要返回</span></span>
<span class="line"><span>- 功能不存在时返回明确的错误信息</span></span></code></pre></div><p><strong>AI 生成</strong>：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">function, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetByKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(functionKey)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Wrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;查询功能失败&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> function </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, errors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">New</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;功能不存在&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">order.Price </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> function.Price</span></span></code></pre></div><hr><h4 id="错误5-一次性修改所有层" tabindex="-1">错误5：一次性修改所有层 <a class="header-anchor" href="#错误5-一次性修改所有层" aria-label="Permalink to &quot;错误5：一次性修改所有层&quot;">​</a></h4><p><strong>症状</strong>：出问题后难以定位是哪一层的问题</p><p><strong>错误示例</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>开发者：实现功能详情接口，包括 Model、Service、API 层</span></span></code></pre></div><p><strong>AI</strong>：（一次性生成大量代码）</p><p><strong>问题</strong>：</p><ul><li>如果有问题，不知道是哪一层的问题</li><li>修改某一层需要重新生成所有层</li></ul><hr><p><strong>正确做法</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>实现功能详情接口</span></span>
<span class="line"><span></span></span>
<span class="line"><span>要求：</span></span>
<span class="line"><span>- 先完成 Model 层（数据查询）</span></span>
<span class="line"><span>- Model 层完成后暂停，等我确认</span></span>
<span class="line"><span>- 确认无误后继续 Service 层</span></span>
<span class="line"><span>- Service 层完成后暂停</span></span>
<span class="line"><span>- 最后完成 API 层</span></span></code></pre></div><p><strong>逐层确认</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>AI: [完成 Model 层]</span></span>
<span class="line"><span>你: ok，继续 Service 层</span></span>
<span class="line"><span></span></span>
<span class="line"><span>AI: [完成 Service 层]</span></span>
<span class="line"><span>你: Service 层需要调整：</span></span>
<span class="line"><span>    @service/function.go#L50 这里应该先判断用户权限</span></span>
<span class="line"><span>    调整后继续 API 层</span></span></code></pre></div><hr><h4 id="错误6-破坏向后兼容" tabindex="-1">错误6：破坏向后兼容 <a class="header-anchor" href="#错误6-破坏向后兼容" aria-label="Permalink to &quot;错误6：破坏向后兼容&quot;">​</a></h4><p><strong>症状</strong>：前端调用报错，或老版本客户端无法使用</p><p><strong>错误示例</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>开发者：修改用户信息接口的返回结构，增加会员字段</span></span></code></pre></div><p><strong>AI 生成</strong>：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UserInfoResponse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    UserID       </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `json:&quot;user_id&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Username     </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `json:&quot;username&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    MemberLevel  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `json:&quot;member_level&quot;`</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 新增</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    MemberExpire </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `json:&quot;member_expire_at&quot;`</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // 新增</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>问题</strong>：如果老版本前端没有处理这两个字段，可能出错</p><hr><p><strong>正确做法</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>修改用户信息接口的返回结构，增加会员字段</span></span>
<span class="line"><span></span></span>
<span class="line"><span>要求：</span></span>
<span class="line"><span>- 新增字段必须向后兼容</span></span>
<span class="line"><span>- 使用 json:&quot;,omitempty&quot; 标签</span></span>
<span class="line"><span>- 非会员用户不返回这两个字段</span></span></code></pre></div><p><strong>AI 生成</strong>：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UserInfoResponse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    UserID       </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `json:&quot;user_id&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Username     </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `json:&quot;username&quot;`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    MemberLevel  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `json:&quot;member_level,omitempty&quot;`</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // omitempty</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    MemberExpire </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `json:&quot;member_expire_at,omitempty&quot;`</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // omitempty</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h4 id="错误7-上下文混乱后继续对话" tabindex="-1">错误7：上下文混乱后继续对话 <a class="header-anchor" href="#错误7-上下文混乱后继续对话" aria-label="Permalink to &quot;错误7：上下文混乱后继续对话&quot;">​</a></h4><p><strong>症状</strong>：AI 开始混淆之前的内容，给出错误的建议</p><p><strong>错误示例</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 对话进行到第 80 轮</span></span>
<span class="line"><span>AI: 根据之前讨论的方案A...（实际之前选择的是方案B）</span></span></code></pre></div><p><strong>问题</strong>：上下文过长，AI 记忆混乱</p><hr><p><strong>正确做法</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 发现混乱后立即清空</span></span>
<span class="line"><span>/clear</span></span>
<span class="line"><span></span></span>
<span class="line"><span>继续之前的任务</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【上次进度】</span></span>
<span class="line"><span>- 已完成：Model 层、Service 层</span></span>
<span class="line"><span>- 当前：需要继续 API 层</span></span>
<span class="line"><span>- 关键决策：采用方案B（统一订单入口）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>请先复述上次的关键决策，然后继续 API 层</span></span></code></pre></div><hr><h4 id="错误8-没有使用-精确引用" tabindex="-1">错误8：没有使用 @ 精确引用 <a class="header-anchor" href="#错误8-没有使用-精确引用" aria-label="Permalink to &quot;错误8：没有使用 @ 精确引用&quot;">​</a></h4><p><strong>症状</strong>：AI 找不到你说的文件，或修改了错误的位置</p><p><strong>错误示例</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>开发者：修改订单文件的第 100 行左右</span></span></code></pre></div><p><strong>问题</strong>：</p><ul><li>哪个订单文件？（model/order.go? service/order.go? api/v1/order.go?）</li><li>第 100 行左右是多少？（90-110?）</li></ul><hr><p><strong>正确做法</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@service/order.go#L100-120</span></span>
<span class="line"><span></span></span>
<span class="line"><span>修改这个函数的{具体部分}</span></span></code></pre></div><hr><h4 id="错误9-频繁说「好的」「ok」「谢谢」" tabindex="-1">错误9：频繁说「好的」「ok」「谢谢」 <a class="header-anchor" href="#错误9-频繁说「好的」「ok」「谢谢」" aria-label="Permalink to &quot;错误9：频繁说「好的」「ok」「谢谢」&quot;">​</a></h4><p><strong>症状</strong>：浪费对话轮次，增加上下文长度</p><p><strong>错误示例</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>AI: 我已经完成了 Model 层的开发</span></span>
<span class="line"><span>开发者: 好的，谢谢</span></span>
<span class="line"><span>AI: 还需要什么帮助？</span></span>
<span class="line"><span>开发者: 继续 Service 层</span></span></code></pre></div><p><strong>浪费了 2 轮对话</strong></p><hr><p><strong>正确做法</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>AI: 我已经完成了 Model 层的开发</span></span>
<span class="line"><span>开发者: 继续 Service 层</span></span>
<span class="line"><span></span></span>
<span class="line"><span>要求：</span></span>
<span class="line"><span>- {具体要求}</span></span></code></pre></div><p><strong>直接进入下一步，节省轮次</strong></p><hr><h4 id="错误10-没有保存关键决策" tabindex="-1">错误10：没有保存关键决策 <a class="header-anchor" href="#错误10-没有保存关键决策" aria-label="Permalink to &quot;错误10：没有保存关键决策&quot;">​</a></h4><p><strong>症状</strong>：一周后忘记为什么这么设计，无法维护</p><p><strong>错误示例</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 开发时做了大量方案讨论</span></span>
<span class="line"><span># 选择了方案B</span></span>
<span class="line"><span># 一周后再看代码，忘记为什么选择方案B</span></span></code></pre></div><hr><p><strong>正确做法</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 重要决策后</span></span>
<span class="line"><span>请将本次讨论的关键决策记录到 WORKFLOW.md：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【任务】</span></span>
<span class="line"><span>实现功能计费模块</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【方案选择】</span></span>
<span class="line"><span>采用方案B：统一订单入口</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【理由】</span></span>
<span class="line"><span>- 理由1：扩展性好，未来增加新场景只需修改一处</span></span>
<span class="line"><span>- 理由2：逻辑集中，易于维护</span></span>
<span class="line"><span>- 理由3：避免代码重复</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【关键实现】</span></span>
<span class="line"><span>- 提取计费场景判断为独立函数 determineBillingScenario()</span></span>
<span class="line"><span>- 使用策略模式处理四种场景</span></span>
<span class="line"><span>- 使用事务保证数据一致性</span></span></code></pre></div><hr><h3 id="_5-2-反模式对照表" tabindex="-1">5.2 反模式对照表 <a class="header-anchor" href="#_5-2-反模式对照表" aria-label="Permalink to &quot;5.2 反模式对照表&quot;">​</a></h3><table tabindex="0"><thead><tr><th>❌ 不好的做法</th><th>✅ 推荐做法</th><th>原因</th></tr></thead><tbody><tr><td>「帮我写一个功能」</td><td>「@{文件} 讨论需求，不要写代码 → 方案确认 → 开始编码」</td><td>没有分析设计阶段，容易返工</td></tr><tr><td>「ok」「好的」（过于频繁）</td><td>合并到实质性指令中</td><td>浪费对话轮次</td></tr><tr><td>重复提交同一命令</td><td>等待响应，避免误操作</td><td>可能导致重复执行</td></tr><tr><td>「在订单文件的第100行」</td><td><code>@service/order.go#L100</code></td><td>不精确，AI 可能找错位置</td></tr><tr><td>修改后才发现理解错误</td><td>先复述需求，确认后再编码</td><td>避免返工</td></tr><tr><td>忘记清理上下文导致混乱</td><td>任务切换时 /clear</td><td>保持上下文清晰</td></tr><tr><td>一次性修改所有层</td><td>分层修改，每层确认后继续</td><td>降低风险，易于定位问题</td></tr><tr><td>没有说明并发安全要求</td><td>明确要求事务/锁/乐观锁</td><td>避免并发问题</td></tr><tr><td>直接删除旧接口</td><td>保留旧接口，标记 deprecated</td><td>保持向后兼容</td></tr><tr><td>没有记录关键决策</td><td>更新 WORKFLOW.md 或 DESIGN.md</td><td>便于后续维护</td></tr></tbody></table><hr><h3 id="_5-3-质量检查清单" tabindex="-1">5.3 质量检查清单 <a class="header-anchor" href="#_5-3-质量检查清单" aria-label="Permalink to &quot;5.3 质量检查清单&quot;">​</a></h3><h4 id="修改前检查清单" tabindex="-1">修改前检查清单 <a class="header-anchor" href="#修改前检查清单" aria-label="Permalink to &quot;修改前检查清单&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>- [ ] 已阅读并理解现有函数的完整逻辑</span></span>
<span class="line"><span>- [ ] 已明确新逻辑的插入位置（第几行之后）</span></span>
<span class="line"><span>- [ ] 已确认对原有逻辑的影响（不影响/部分影响/完全改变）</span></span>
<span class="line"><span>- [ ] 已确认是否需要修改数据库（表结构/索引）</span></span>
<span class="line"><span>- [ ] 已确认是否需要修改函数签名（参数/返回值）</span></span>
<span class="line"><span>- [ ] 已确认兼容性要求（向后兼容/不兼容）</span></span>
<span class="line"><span>- [ ] 已确认并发安全方案（事务/锁/乐观锁）</span></span>
<span class="line"><span>- [ ] 已使用 @ 精确引用文件和行号</span></span></code></pre></div><hr><h4 id="修改后检查清单" tabindex="-1">修改后检查清单 <a class="header-anchor" href="#修改后检查清单" aria-label="Permalink to &quot;修改后检查清单&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>- [ ] 新逻辑已正确插入到指定位置</span></span>
<span class="line"><span>- [ ] 原有逻辑未被破坏（通过阅读代码确认）</span></span>
<span class="line"><span>- [ ] 边界条件已处理（null/空数组/并发/数据不存在）</span></span>
<span class="line"><span>- [ ] 错误处理已添加（与原函数风格一致）</span></span>
<span class="line"><span>- [ ] 日志已添加（关键步骤记录日志）</span></span>
<span class="line"><span>- [ ] 注释已添加（说明新逻辑的业务含义）</span></span>
<span class="line"><span>- [ ] 代码风格与原函数保持一致</span></span>
<span class="line"><span>- [ ] 向后兼容性已保持（新字段 omitempty/旧接口保留）</span></span>
<span class="line"><span>- [ ] 已列出测试要点（或已编写测试用例）</span></span>
<span class="line"><span>- [ ] 关键决策已记录（WORKFLOW.md/DESIGN.md）</span></span></code></pre></div><hr><h4 id="上线前检查清单" tabindex="-1">上线前检查清单 <a class="header-anchor" href="#上线前检查清单" aria-label="Permalink to &quot;上线前检查清单&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【代码检查】</span></span>
<span class="line"><span>- [ ] 所有 TODO 注释已清理</span></span>
<span class="line"><span>- [ ] 调试日志已删除（如 fmt.Println）</span></span>
<span class="line"><span>- [ ] 代码已格式化（gofmt/prettier）</span></span>
<span class="line"><span>- [ ] 无编译警告</span></span>
<span class="line"><span>- [ ] 硬编码的值已提取为常量</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【数据库检查】</span></span>
<span class="line"><span>- [ ] DDL 脚本已审核</span></span>
<span class="line"><span>- [ ] 数据迁移脚本已验证（在测试环境）</span></span>
<span class="line"><span>- [ ] 回滚脚本已准备</span></span>
<span class="line"><span>- [ ] 索引已添加（对大表的查询）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【文档检查】</span></span>
<span class="line"><span>- [ ] API 文档已更新（OpenAPI/ApiPost）</span></span>
<span class="line"><span>- [ ] 数据库文档已更新（新表/新字段）</span></span>
<span class="line"><span>- [ ] CHANGELOG 已记录</span></span>
<span class="line"><span>- [ ] README 已更新（如有新的依赖）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【测试检查】</span></span>
<span class="line"><span>- [ ] 单元测试通过</span></span>
<span class="line"><span>- [ ] 集成测试通过</span></span>
<span class="line"><span>- [ ] 回归测试通过（原有功能不受影响）</span></span>
<span class="line"><span>- [ ] 性能测试通过（如适用）</span></span>
<span class="line"><span>- [ ] 并发测试通过（如涉及并发）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【部署检查】</span></span>
<span class="line"><span>- [ ] 部署顺序已确定（先数据库后代码/先代码后数据库）</span></span>
<span class="line"><span>- [ ] 回滚方案已确认</span></span>
<span class="line"><span>- [ ] 监控告警已配置</span></span>
<span class="line"><span>- [ ] 灰度发布方案已准备（如适用）</span></span></code></pre></div><hr><h2 id="第六部分-练习篇" tabindex="-1">第六部分：练习篇 <a class="header-anchor" href="#第六部分-练习篇" aria-label="Permalink to &quot;第六部分：练习篇&quot;">​</a></h2><h3 id="_6-1-练习1-简单业务逻辑增加" tabindex="-1">6.1 练习1：简单业务逻辑增加 <a class="header-anchor" href="#_6-1-练习1-简单业务逻辑增加" aria-label="Permalink to &quot;6.1 练习1：简单业务逻辑增加&quot;">​</a></h3><h4 id="场景" tabindex="-1">场景 <a class="header-anchor" href="#场景" aria-label="Permalink to &quot;场景&quot;">​</a></h4><p>在商品列表接口中，如果商品有折扣，需要额外返回折扣信息（折扣比例、原价、现价）。</p><h4 id="要求" tabindex="-1">要求 <a class="header-anchor" href="#要求" aria-label="Permalink to &quot;要求&quot;">​</a></h4><ol><li>使用《业务逻辑增加模板 - 简单逻辑增加》</li><li>完整写出与 AI 的对话</li><li>每轮对话标注目标和使用的模板</li></ol><h4 id="参考答案" tabindex="-1">参考答案 <a class="header-anchor" href="#参考答案" aria-label="Permalink to &quot;参考答案&quot;">​</a></h4><p><strong>第1轮：理解现状 + 设计方案</strong></p><p>使用模板：业务逻辑增加模板 - 流程一阶段1</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@api/v1/product.go#L50-80</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【当前功能】</span></span>
<span class="line"><span>获取商品列表接口，返回商品基本信息（ID、名称、价格、图片）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【需要增加的逻辑】</span></span>
<span class="line"><span>如果商品有折扣，额外返回折扣信息：</span></span>
<span class="line"><span>- 折扣比例（如 8折）</span></span>
<span class="line"><span>- 原价</span></span>
<span class="line"><span>- 现价</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【触发条件】</span></span>
<span class="line"><span>- 商品表的 discount_rate 字段 &gt; 0 且 &lt; 1.0 时</span></span>
<span class="line"><span>- 不影响无折扣商品的原有返回</span></span>
<span class="line"><span></span></span>
<span class="line"><span>请先：</span></span>
<span class="line"><span>1. 复述当前函数的核心逻辑</span></span>
<span class="line"><span>2. 说明新逻辑应该插入的位置</span></span>
<span class="line"><span>3. 给出代码修改建议</span></span>
<span class="line"><span></span></span>
<span class="line"><span>不要写代码</span></span></code></pre></div><p><strong>AI 回复</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【当前逻辑复述】</span></span>
<span class="line"><span>1. 接收分页参数（page, page_size）</span></span>
<span class="line"><span>2. 查询 product 表获取商品列表</span></span>
<span class="line"><span>3. 遍历商品，组装 ProductListItem 结构体</span></span>
<span class="line"><span>4. 返回 JSON 响应</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【新逻辑插入位置】</span></span>
<span class="line"><span>在第3步「组装结构体」时增加折扣判断</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【代码修改建议】</span></span>
<span class="line"><span>1. 在 ProductListItem 结构体中新增字段：</span></span>
<span class="line"><span>   - HasDiscount bool `json:&quot;has_discount,omitempty&quot;`</span></span>
<span class="line"><span>   - DiscountRate float64 `json:&quot;discount_rate,omitempty&quot;`</span></span>
<span class="line"><span>   - OriginalPrice int `json:&quot;original_price,omitempty&quot;`</span></span>
<span class="line"><span>   - CurrentPrice int `json:&quot;current_price,omitempty&quot;`</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2. 组装时增加判断：</span></span>
<span class="line"><span>   if product.DiscountRate &gt; 0 &amp;&amp; product.DiscountRate &lt; 1.0 {</span></span>
<span class="line"><span>       item.HasDiscount = true</span></span>
<span class="line"><span>       item.DiscountRate = product.DiscountRate</span></span>
<span class="line"><span>       item.OriginalPrice = product.Price</span></span>
<span class="line"><span>       item.CurrentPrice = int(float64(product.Price) * product.DiscountRate)</span></span>
<span class="line"><span>   }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【影响分析】</span></span>
<span class="line"><span>- 不影响无折扣商品（使用 omitempty）</span></span>
<span class="line"><span>- 不需要修改数据库</span></span>
<span class="line"><span>- 不需要修改查询逻辑</span></span></code></pre></div><p><strong>第2轮：确认并开始修改</strong></p><p>使用模板：业务逻辑增加模板 - 流程一阶段2</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>方案合理，采用上述方案，开始修改</span></span>
<span class="line"><span></span></span>
<span class="line"><span>要求：</span></span>
<span class="line"><span>- 遵循 CLAUDE.md 规范</span></span>
<span class="line"><span>- 保持原有代码风格</span></span>
<span class="line"><span>- 添加注释说明折扣计算逻辑</span></span>
<span class="line"><span>- 字段使用 omitempty 标签</span></span></code></pre></div><p><strong>第3轮：验证</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>看起来不错，请列出测试要点</span></span></code></pre></div><p><strong>AI 输出测试清单</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【测试场景】</span></span>
<span class="line"><span>1. 有折扣的商品：应返回折扣信息字段</span></span>
<span class="line"><span>2. 无折扣的商品（discount_rate = 0）：不返回折扣字段</span></span>
<span class="line"><span>3. 无折扣的商品（discount_rate = 1.0）：不返回折扣字段</span></span>
<span class="line"><span>4. 混合列表：部分有折扣，部分无折扣</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【边界测试】</span></span>
<span class="line"><span>- discount_rate = 0.01（1折）</span></span>
<span class="line"><span>- discount_rate = 0.99（9.9折）</span></span>
<span class="line"><span>- 价格计算精度（是否有四舍五入问题）</span></span></code></pre></div><hr><h3 id="_6-2-练习2-bug-修复" tabindex="-1">6.2 练习2：Bug 修复 <a class="header-anchor" href="#_6-2-练习2-bug-修复" aria-label="Permalink to &quot;6.2 练习2：Bug 修复&quot;">​</a></h3><h4 id="场景-1" tabindex="-1">场景 <a class="header-anchor" href="#场景-1" aria-label="Permalink to &quot;场景&quot;">​</a></h4><p>用户反馈：购买会员后，商品详情页面显示的价格还是原价，没有显示会员价。</p><h4 id="要求-1" tabindex="-1">要求 <a class="header-anchor" href="#要求-1" aria-label="Permalink to &quot;要求&quot;">​</a></h4><ol><li>使用《流程化提示词 - Bug修复流程》</li><li>完整写出与 AI 的对话</li><li>分析根因后给出修复方案</li></ol><h4 id="参考答案-1" tabindex="-1">参考答案 <a class="header-anchor" href="#参考答案-1" aria-label="Permalink to &quot;参考答案&quot;">​</a></h4><p><strong>第1轮：问题复现</strong></p><p>使用模板：Bug修复流程 - 阶段1</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/clear</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【Bug 描述】</span></span>
<span class="line"><span>购买会员后，商品详情页显示的价格还是原价，没有显示会员价</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【复现步骤】</span></span>
<span class="line"><span>1. 用户 A 购买会员（会员状态为 true）</span></span>
<span class="line"><span>2. 访问商品详情页 /api/product/detail?id=123</span></span>
<span class="line"><span>3. 返回的价格是 price 字段，而不是 member_price 字段</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【预期行为】</span></span>
<span class="line"><span>会员用户应该看到会员价</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【实际行为】</span></span>
<span class="line"><span>会员用户看到的还是原价</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【相关代码】</span></span>
<span class="line"><span>@api/v1/product.go#L100-130（商品详情接口）</span></span>
<span class="line"><span>@service/product.go#L50-80（获取商品详情逻辑）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>请分析可能的原因，不要写代码</span></span></code></pre></div><p><strong>AI 回复</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【可能原因分析】</span></span>
<span class="line"><span></span></span>
<span class="line"><span>最可能的原因：</span></span>
<span class="line"><span>1. 没有获取用户的会员状态</span></span>
<span class="line"><span>2. 没有根据会员状态返回不同的价格</span></span>
<span class="line"><span>3. 返回结构体只有 price 字段，没有 member_price 字段</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【需要确认】</span></span>
<span class="line"><span>1. Service 层是否获取了用户信息</span></span>
<span class="line"><span>2. 是否有判断用户是否是会员</span></span>
<span class="line"><span>3. 返回结构体的字段定义</span></span></code></pre></div><p><strong>第2轮：根因分析</strong></p><p>使用模板：Bug修复流程 - 阶段2</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>请查看 @service/product.go#L50-80，确认具体原因</span></span></code></pre></div><p><strong>AI 确认</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【根因确认】</span></span>
<span class="line"><span>查看代码后，发现问题：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>service/product.go 中的 GetProductDetail 函数：</span></span>
<span class="line"><span>1. 查询了商品信息</span></span>
<span class="line"><span>2. 直接返回了 product.Price</span></span>
<span class="line"><span>3. 没有获取用户信息</span></span>
<span class="line"><span>4. 没有判断用户是否是会员</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【问题代码】</span></span>
<span class="line"><span>func GetProductDetail(productID int) (*ProductDetail, error) {</span></span>
<span class="line"><span>    product, err := model.Product{}.GetByID(productID)</span></span>
<span class="line"><span>    if err != nil {</span></span>
<span class="line"><span>        return nil, err</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    return &amp;ProductDetail{</span></span>
<span class="line"><span>        ProductID: product.ID,</span></span>
<span class="line"><span>        Name:      product.Name,</span></span>
<span class="line"><span>        Price:     product.Price,  // 问题：总是返回原价</span></span>
<span class="line"><span>    }, nil</span></span>
<span class="line"><span>}</span></span></code></pre></div><p><strong>第3轮：修复方案</strong></p><p>使用模板：Bug修复流程 - 阶段3</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>确认根因是没有判断用户会员状态</span></span>
<span class="line"><span></span></span>
<span class="line"><span>请给出修复方案，不要写代码</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【修复方式对比】</span></span>
<span class="line"><span>方案1：{快速修复方案}</span></span>
<span class="line"><span>方案2：{彻底解决方案}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>对比：</span></span>
<span class="line"><span>- 修复彻底性</span></span>
<span class="line"><span>- 引入新问题的风险</span></span>
<span class="line"><span>- 工作量</span></span>
<span class="line"><span>- 是否需要回归测试</span></span>
<span class="line"><span></span></span>
<span class="line"><span>推荐方案并说明理由</span></span></code></pre></div><p><strong>AI 回复</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【方案对比】</span></span>
<span class="line"><span></span></span>
<span class="line"><span>方案1：在 Service 层增加会员判断</span></span>
<span class="line"><span>- 修改 GetProductDetail 函数，接收 gin.Context 参数</span></span>
<span class="line"><span>- 通过 service.GetUserInfo(c) 获取用户信息</span></span>
<span class="line"><span>- 判断用户是否是会员，返回对应价格</span></span>
<span class="line"><span></span></span>
<span class="line"><span>方案2：在 API 层处理</span></span>
<span class="line"><span>- Service 层返回完整商品信息（包括 price 和 member_price）</span></span>
<span class="line"><span>- API 层根据用户会员状态选择返回哪个价格</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【对比】</span></span>
<span class="line"><span></span></span>
<span class="line"><span>| 维度 | 方案1 | 方案2 |</span></span>
<span class="line"><span>|------|-------|-------|</span></span>
<span class="line"><span>| 彻底性 | 高 | 高 |</span></span>
<span class="line"><span>| 风险 | 中（需修改函数签名） | 低（不改 Service 层） |</span></span>
<span class="line"><span>| 工作量 | 中 | 低 |</span></span>
<span class="line"><span>| 架构合理性 | 更好（业务逻辑在 Service 层） | 较差（业务逻辑在 API 层） |</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【推荐方案1】</span></span>
<span class="line"><span>理由：</span></span>
<span class="line"><span>- 业务逻辑应该在 Service 层处理，不应该在 API 层</span></span>
<span class="line"><span>- 虽然需要修改函数签名，但符合分层原则</span></span>
<span class="line"><span>- 便于其他地方复用（如后台管理也需要获取商品详情）</span></span></code></pre></div><p><strong>第4轮：实施修复</strong></p><p>使用模板：Bug修复流程 - 阶段4</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>采用方案1，开始修复</span></span>
<span class="line"><span></span></span>
<span class="line"><span>要求：</span></span>
<span class="line"><span>- 最小化改动范围</span></span>
<span class="line"><span>- 添加注释说明会员价逻辑</span></span>
<span class="line"><span>- 保持代码风格一致</span></span></code></pre></div><hr><h3 id="_6-3-练习3-方案选择" tabindex="-1">6.3 练习3：方案选择 <a class="header-anchor" href="#_6-3-练习3-方案选择" aria-label="Permalink to &quot;6.3 练习3：方案选择&quot;">​</a></h3><h4 id="场景-2" tabindex="-1">场景 <a class="header-anchor" href="#场景-2" aria-label="Permalink to &quot;场景&quot;">​</a></h4><p>需要实现一个订单列表接口，支持多种筛选条件：</p><ul><li>按订单状态筛选（待支付、已完成、已取消）</li><li>按时间范围筛选</li><li>按商品类型筛选</li><li>支持分页</li></ul><p><strong>问题</strong>：如何设计查询条件的传递和处理？</p><h4 id="要求-2" tabindex="-1">要求 <a class="header-anchor" href="#要求-2" aria-label="Permalink to &quot;要求&quot;">​</a></h4><ol><li>使用《提示词模板优化版 - 方案对比》</li><li>列出至少 3 个方案</li><li>对比优缺点</li><li>给出推荐方案</li></ol><h4 id="参考答案-2" tabindex="-1">参考答案 <a class="header-anchor" href="#参考答案-2" aria-label="Permalink to &quot;参考答案&quot;">​</a></h4><p><strong>对话</strong></p><p>使用模板：提示词模板优化版 - 设计阶段 - 方案对比（模板C）</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>讨论需求，不要写代码</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【功能需求】</span></span>
<span class="line"><span>实现订单列表接口，支持多种筛选条件：</span></span>
<span class="line"><span>- 按订单状态筛选（status: pending/completed/cancelled）</span></span>
<span class="line"><span>- 按时间范围筛选（start_time, end_time）</span></span>
<span class="line"><span>- 按商品类型筛选（product_type: 1-5）</span></span>
<span class="line"><span>- 支持分页（page, page_size）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【问题】</span></span>
<span class="line"><span>如何设计查询条件的传递和处理？</span></span>
<span class="line"><span></span></span>
<span class="line"><span>请提供 2-3 个设计方案，对比以下维度：</span></span>
<span class="line"><span>- 代码可读性</span></span>
<span class="line"><span>- 扩展性（未来增加新的筛选条件）</span></span>
<span class="line"><span>- 性能（SQL 查询效率）</span></span>
<span class="line"><span>- 易用性（前端调用是否方便）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>不要写代码</span></span></code></pre></div><p><strong>AI 回复</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>【方案1：独立参数传递】</span></span>
<span class="line"><span></span></span>
<span class="line"><span>函数签名：</span></span>
<span class="line"><span>func GetOrderList(status string, startTime, endTime time.Time, productType int, page, pageSize int) ([]Order, error)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>优点：</span></span>
<span class="line"><span>- 类型安全，编译时检查</span></span>
<span class="line"><span>- 参数含义明确</span></span>
<span class="line"><span></span></span>
<span class="line"><span>缺点：</span></span>
<span class="line"><span>- 参数过多，函数签名臃肿</span></span>
<span class="line"><span>- 增加新筛选条件需要修改函数签名</span></span>
<span class="line"><span>- 可选参数不好处理（如不筛选状态时，传什么？）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【方案2：结构体参数】</span></span>
<span class="line"><span></span></span>
<span class="line"><span>定义筛选条件结构体：</span></span>
<span class="line"><span>type OrderListQuery struct {</span></span>
<span class="line"><span>    Status      string     `form:&quot;status&quot;`</span></span>
<span class="line"><span>    StartTime   *time.Time `form:&quot;start_time&quot;`</span></span>
<span class="line"><span>    EndTime     *time.Time `form:&quot;end_time&quot;`</span></span>
<span class="line"><span>    ProductType *int       `form:&quot;product_type&quot;`</span></span>
<span class="line"><span>    Page        int        `form:&quot;page&quot;`</span></span>
<span class="line"><span>    PageSize    int        `form:&quot;page_size&quot;`</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>函数签名：</span></span>
<span class="line"><span>func GetOrderList(query OrderListQuery) ([]Order, error)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>优点：</span></span>
<span class="line"><span>- 参数清晰，易于扩展</span></span>
<span class="line"><span>- 可选参数用指针表示（nil = 不筛选）</span></span>
<span class="line"><span>- 可以复用结构体（如导出功能也用这个筛选条件）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>缺点：</span></span>
<span class="line"><span>- 需要检查每个字段是否为 nil</span></span>
<span class="line"><span>- 结构体字段较多</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【方案3：函数式选项（Functional Options）】</span></span>
<span class="line"><span></span></span>
<span class="line"><span>定义选项函数：</span></span>
<span class="line"><span>type OrderListOption func(*OrderListQuery)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>func WithStatus(status string) OrderListOption</span></span>
<span class="line"><span>func WithTimeRange(start, end time.Time) OrderListOption</span></span>
<span class="line"><span>func WithProductType(productType int) OrderListOption</span></span>
<span class="line"><span></span></span>
<span class="line"><span>函数签名：</span></span>
<span class="line"><span>func GetOrderList(page, pageSize int, opts ...OrderListOption) ([]Order, error)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>优点：</span></span>
<span class="line"><span>- 可读性好：GetOrderList(1, 10, WithStatus(&quot;pending&quot;), WithTimeRange(...))</span></span>
<span class="line"><span>- 易于扩展：增加选项不影响函数签名</span></span>
<span class="line"><span>- 可选参数优雅处理</span></span>
<span class="line"><span></span></span>
<span class="line"><span>缺点：</span></span>
<span class="line"><span>- 实现较复杂</span></span>
<span class="line"><span>- 对新手不友好</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【对比总结】</span></span>
<span class="line"><span></span></span>
<span class="line"><span>| 维度 | 方案1 | 方案2 | 方案3 |</span></span>
<span class="line"><span>|------|-------|-------|-------|</span></span>
<span class="line"><span>| 可读性 | 中 | 好 | 很好 |</span></span>
<span class="line"><span>| 扩展性 | 差 | 好 | 很好 |</span></span>
<span class="line"><span>| 性能 | 相同 | 相同 | 相同 |</span></span>
<span class="line"><span>| 易用性（前端） | 差 | 好 | 好 |</span></span>
<span class="line"><span>| 实现复杂度 | 低 | 低 | 中 |</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>【推荐方案2】</span></span>
<span class="line"><span></span></span>
<span class="line"><span>理由：</span></span>
<span class="line"><span>- 对于列表查询接口，结构体参数是最常见的做法</span></span>
<span class="line"><span>- 扩展性好，增加筛选条件只需在结构体中加字段</span></span>
<span class="line"><span>- 实现简单，团队容易理解</span></span>
<span class="line"><span>- Gin 框架自动绑定 query 参数到结构体，前端调用方便</span></span>
<span class="line"><span></span></span>
<span class="line"><span>方案3 更适合配置类场景（如初始化数据库连接），对于业务接口，方案2 更合适。</span></span></code></pre></div><hr><h3 id="_6-4-自我评估表" tabindex="-1">6.4 自我评估表 <a class="header-anchor" href="#_6-4-自我评估表" aria-label="Permalink to &quot;6.4 自我评估表&quot;">​</a></h3><p>完成以上练习后，对照以下标准自我评估：</p><h4 id="评分标准-每项-0-10-分" tabindex="-1">评分标准（每项 0-10 分） <a class="header-anchor" href="#评分标准-每项-0-10-分" aria-label="Permalink to &quot;评分标准（每项 0-10 分）&quot;">​</a></h4><table tabindex="0"><thead><tr><th>评估项</th><th>自评分数</th><th>说明</th></tr></thead><tbody><tr><td>1. 是否使用三段式工作流（分析→设计→实施）</td><td>/10</td><td>没有跳过分析/设计阶段</td></tr><tr><td>2. 是否使用 @ 精确引用文件和行号</td><td>/10</td><td>没有模糊描述位置</td></tr><tr><td>3. 是否在分析/设计阶段使用「不要写代码」</td><td>/10</td><td>没有过早要求编码</td></tr><tr><td>4. 是否分层实施，每层确认后继续</td><td>/10</td><td>没有一次性修改所有层</td></tr><tr><td>5. 是否考虑并发安全和边界条件</td><td>/10</td><td>明确了事务/锁的使用</td></tr><tr><td>6. 是否保持向后兼容</td><td>/10</td><td>新增字段使用 omitempty</td></tr><tr><td>7. 是否对比了多个方案后再决策</td><td>/10</td><td>没有直接采用第一个方案</td></tr><tr><td>8. 是否使用检查清单验证</td><td>/10</td><td>修改后进行了系统检查</td></tr><tr><td><strong>总分</strong></td><td><strong>/80</strong></td><td>64分以上：优秀；48-63分：良好；48分以下：需加强</td></tr></tbody></table><hr><h2 id="📚-附录" tabindex="-1">📚 附录 <a class="header-anchor" href="#📚-附录" aria-label="Permalink to &quot;📚 附录&quot;">​</a></h2><h3 id="推荐阅读顺序" tabindex="-1">推荐阅读顺序 <a class="header-anchor" href="#推荐阅读顺序" aria-label="Permalink to &quot;推荐阅读顺序&quot;">​</a></h3><p><strong>第1次学习（2-3小时）</strong>：</p><ol><li>理念篇（了解为什么）</li><li>基础篇（掌握核心语法）</li><li>实战篇 - 场景1（跟着练习一遍）</li><li>避坑篇 - 十大错误（记住常见错误）</li></ol><p><strong>第2次学习（工作中实践）</strong>：</p><ul><li>遇到具体场景时，查阅对应的实战案例</li><li>配合《速查手册》快速查找模板</li></ul><p><strong>第3次学习（进阶）</strong>：</p><ul><li>进阶篇（流程组合、多人协作）</li><li>练习篇（完成所有练习）</li></ul><hr><h3 id="配套文档" tabindex="-1">配套文档 <a class="header-anchor" href="#配套文档" aria-label="Permalink to &quot;配套文档&quot;">​</a></h3><ol><li><strong>Claude_Code_速查手册.md</strong>：桌面速查，快速查找模板</li><li><strong>Claude_Code_完整参考手册.md</strong>：详尽工具书，深入查阅</li></ol><hr><h3 id="反馈与改进" tabindex="-1">反馈与改进 <a class="header-anchor" href="#反馈与改进" aria-label="Permalink to &quot;反馈与改进&quot;">​</a></h3><p>如果您在使用过程中发现：</p><ul><li>某个场景没有覆盖</li><li>某个模板不够清晰</li><li>有更好的实践方法</li></ul><p>欢迎反馈，我们会持续优化这份教程。</p><hr><p><strong>🎉 恭喜你完成 Claude Code 培训教程的学习！</strong></p><p><strong>下一步行动</strong>：</p><ol><li>打印《速查手册》放在桌面</li><li>在实际项目中尝试使用</li><li>建立项目的 CLAUDE.md 规范文件</li><li>记录使用过程中的心得体会</li></ol><p><strong>记住核心原则</strong>：</p><ul><li>先分析，再设计，后实施</li><li>使用 @ 精确引用</li><li>关键时刻说「不要写代码」</li><li>分步执行，每步确认</li></ul><p>祝您使用 Claude Code 愉快！🚀</p></div></div></main><footer class="VPDocFooter" data-v-28ef3a16 data-v-3fa11a47><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-3fa11a47><span class="visually-hidden" id="doc-footer-aria-label" data-v-3fa11a47>Pager</span><div class="pager" data-v-3fa11a47><!----></div><div class="pager" data-v-3fa11a47><a class="VPLink link pager-link next" href="/guogao-doc/markdown-examples.html" data-v-3fa11a47><!--[--><span class="desc" data-v-3fa11a47>Next page</span><span class="title" data-v-3fa11a47>Markdown Examples</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api-examples.md\":\"Z0SO5mlP\",\"claude_code_培训教程.md\":\"5x5xO3Vn\",\"index.md\":\"6Il5WFp5\",\"markdown-examples.md\":\"BWSKuzbG\",\"培训话术-完整版.md\":\"DbyPdhbT\",\"培训话术-讲师稿.md\":\"C-Gefa_y\",\"快速上手教程-口语版.md\":\"CcZH0R7I\",\"快速上手教程.md\":\"DTMfI01H\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"My Awesome Project\",\"description\":\"A VitePress Site\",\"base\":\"/guogao-doc/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Examples\",\"link\":\"/markdown-examples\"},{\"text\":\"快速上手教程\",\"link\":\"/快速上手教程\"},{\"text\":\"Examples2\",\"link\":\"/培训话术-完整版\"}],\"sidebar\":[{\"text\":\"Examples\",\"items\":[{\"text\":\"Markdown Examples\",\"link\":\"/markdown-examples\"},{\"text\":\"Runtime API Examples\",\"link\":\"/api-examples\"}]}],\"outline\":{\"level\":[2,4],\"label\":\"目录\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>